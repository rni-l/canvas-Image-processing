{"version":3,"sources":["../js/index/node_modules/.6.0.2@browser-pack/_prelude.js","../js/index/src/js/index/draw.js","../js/index/src/js/index/filter.js","../js/index/src/js/index/lineData.js","../js/index/src/js/index/main.js","../js/index/src/js/index/opts.js","../js/index/src/js/index/photograph.js","../js/index/src/js/index/selectImgSize.js","../js/index/src/plugins/colorPicker.js","../js/index/src/plugins/exif.js","../js/index/src/plugins/fastclick.js","../js/index/src/plugins/imagefilters.js","../js/index/src/utils/filterData.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length","1","module","addData","data","arrX","push","x","arrY","y","arrN","arrColor","color","arrWidth","width","draw","len","ctx","beginPath","lineCap","lineJoin","lineWidth","strokeStyle","lastX","lastY","save","moveTo","lineTo","stroke","restore","closePath","move","preventDefault","touches","Math","floor","pageX","c_left","pageY","c_top","_lineData2","default","w","arrNumber","_opts2","oCan","offsetLeft","offsetTop","oRevoke","addEventListener","pop","clearRect","canvasW","canvasH","drawImage","img","imgPos","h","_filter2","cavasH","isDraw","isNewPic","changedTouches","removeEventListener","setFilter","type","arguments","undefined","typeName","imgData","imageData","filtered","_imagefilters2","apply","concat","_toConsumableArray","filterData","filter","pos","putImageData","updateFilter","dataList","forEach","v","value","_draw2","format","str","name","chooseValue","_range","range","max","min","first","oFilterBox","document","getElementById","oFilterSelect","oContent","querySelector","target","getAttribute","tar","nextSibling","innerHTML","isStopPrevent","_this","this","arr","_filterData2","filterValue","aInput","querySelectorAll","nodeName","output","rangeMove","my","clientY","r_opts","transform","oRange","num","oP","oColorBtn","oColorBox","colorOnoff","oRangePar","offsetHeight","rH","size","_colorPicker2","oBox","oBtnWrap","height","callback","style","background","init","stopPropagation","fx","clientX","fy","_fastclick2","attach","body","_opts3","display","oTop","offsetWidth","getContext","oShowImg","oMsg","oZhezhao","showLoading","obj","WebkitTransform","cacheImg","url","console","log","Image","onload","src","showFun","oAsideBtn","oCreateBtn","isCreatePic","computeWidthAndHeight","drawWidth","drawHeight","degree","maxSide","params","minSide","canvas","createElement","context","Orientation","getImgData","PixelXDimension","naturalWidth","PixelYDimension","naturalHeight","rotate","PI","next","toDataURL","uploadFileCallBack","cW","cH","getImageData","oAside","oFile","file","files","exifData","alert","reader","FileReader","Promise","resolve","_exif2","getData","getAllTags","then","result","readAsDataURL","parentNode","removeChild","position","$","post","id","selectPicSize","check_type","cw","ch","set_x","set_y","set_w","set_h","ColorPicker","lineW","r2","iW","cos","iX","where","opts","insideX","insideY","bindMove","prototype","oInsideBtn","oOutsideBtn","btnW","createColorBg","createInsideColor","bind","addMove","removeMove","oCan_left","canPos","getElemPos","oCan_top","rad","c_x","c_y","sin","fillStyle","fillRect","g","createLinearGradient","addColorStop","btnPosition","getColor","d","sqrt","pow","btnW2","x1","y1","y2","top","left","offsetParent","imageHasData","exifdata","base64ToArrayBuffer","base64","contentType","match","replace","binary","atob","buffer","ArrayBuffer","view","Uint8Array","charCodeAt","objectURLToBlob","http","XMLHttpRequest","open","responseType","status","response","send","handleBinaryFile","binFile","findEXIFinJPEG","iptcdata","findIPTCinJPEG","test","fileReader","blob","readAsArrayBuffer","window","Blob","File","debug","byteLength","dataView","DataView","getUint8","marker","offset","readEXIFData","getUint16","isFieldSegmentStart","nameHeaderLength","readIPTCData","startOffset","sectionLength","fieldValue","fieldName","dataSize","segmentType","segmentStartPos","IptcFieldMap","getInt16","getStringFromDB","hasOwnProperty","Array","readTags","tiffStart","dirStart","strings","bigEnd","entryOffset","tag","entries","tags","readTagValue","vals","val","numerator","denominator","numValues","getUint32","valueOffset","Number","getInt32","start","outstr","String","fromCharCode","gpsData","tiffOffset","firstIFDOffset","TiffTags","ExifIFDPointer","ExifTags","StringValues","Components","GPSInfoIFDPointer","GPSTags","root","EXIF","EXIFwrapped","Tags","36864","40960","40961","40962","40963","37121","37122","37500","37510","40964","36867","36868","37520","37521","37522","33434","33437","34850","34852","34855","34856","37377","37378","37379","37380","37381","37382","37383","37384","37385","37396","37386","41483","41484","41486","41487","41488","41492","41493","41495","41728","41729","41730","41985","41986","41987","41988","41989","41990","41991","41992","41993","41994","41995","41996","40965","42016","256","257","34665","34853","258","259","262","274","277","284","530","531","282","283","296","273","278","279","513","514","301","318","319","529","532","306","270","271","272","305","315","33432","0","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","ExposureProgram","MeteringMode","255","LightSource","Flash","31","32","65","69","71","73","77","79","89","93","95","SensingMethod","SceneCaptureType","SceneType","CustomRendered","WhiteBalance","GainControl","Contrast","Saturation","Sharpness","SubjectDistanceRange","FileSource","120","110","55","80","85","122","105","116","HTMLImageElement","complete","getTag","getIptcTag","getAllIptcTags","pretty","strPretty","_typeof","readFromBinaryFile","define","amd","FastClick","layer","options","oldOnClick","trackingClick","trackingClickStart","targetElement","touchStartX","touchStartY","lastTouchIdentifier","touchBoundary","tapDelay","tapTimeout","notNeeded","methods","method","deviceIsAndroid","onMouse","onClick","onTouchStart","onTouchMove","onTouchEnd","onTouchCancel","Event","stopImmediatePropagation","capture","rmv","Node","hijacked","adv","event","propagationStopped","onclick","deviceIsWindowsPhone","navigator","userAgent","indexOf","deviceIsIOS","deviceIsIOS4","deviceIsIOSWithBadTarget","deviceIsBlackBerry10","needsClick","toLowerCase","disabled","className","needsFocus","readOnly","sendClick","clickEvent","touch","activeElement","blur","createEvent","initMouseEvent","determineEventType","screenX","screenY","forwardedTouchEvent","dispatchEvent","tagName","focus","setSelectionRange","updateScrollParent","scrollParent","parentElement","fastClickScrollParent","contains","scrollHeight","fastClickLastScrollTop","scrollTop","getTargetElementFromEventTarget","eventTarget","nodeType","TEXT_NODE","selection","targetTouches","getSelection","rangeCount","isCollapsed","identifier","timeStamp","lastClickTime","touchHasMoved","boundary","abs","findControl","labelElement","control","htmlFor","forElement","targetTagName","cancelNextClick","elementFromPoint","pageXOffset","pageYOffset","cancelable","permitted","detail","destroy","metaViewport","chromeVersion","blackberryVersion","ontouchstart","exec","content","documentElement","scrollWidth","outerWidth","msTouchAction","touchAction","ImageFilters","utils","initSampleCanvas","_canvas","_context","getSampleCanvas","getSampleContext","createImageData","ImageData","clamp","buildMap","m","k","applyMap","dst","map","mapRGB","func","getPixelIndex","edge","getPixel","getPixelByIndex","copyBilinear","dstIndex","cx","cy","b","wx","wy","nw","ne","sw","se","rgbToHsl","chroma","hslToRgb","m1","m2","hue","rgb","tmp","Translate","srcImageData","interpolation","Scale","scaleX","scaleY","Rotate","originX","originY","angle","resize","Affine","matrix","UnsharpMask","level","ConvolutionFilter","matrixX","matrixY","divisor","bias","preserveAlpha","alpha","srcPixels","srcWidth","srcHeight","dstImageData","dstPixels","index","rows","cols","clampR","clampG","clampB","clampA","mIndex","row","rowIndex","col","colIndex","p","Binarize","threshold","srcLength","isNaN","avg","BlendAdd","blendImageData","dx","dy","blendPixels","BlendSubtract","BoxBlur","radius","prev","nextIndex","prevIndex","tableSize","radiusPlus1","widthMinus1","srcIndex","sumTable","hRadius","vRadius","quality","tmpPixels","GaussianBlur","strength","StackBlur","BlurStack","mul_table","shg_table","yp","yi","yw","r_sum","g_sum","b_sum","a_sum","r_out_sum","g_out_sum","b_out_sum","a_out_sum","r_in_sum","g_in_sum","b_in_sum","a_in_sum","pr","pg","pb","pa","rbs","stackIn","stackOut","stackEnd","Clone","div","heightMinus1","sumFactor","stackStart","stack","mul_sum","shg_sum","Brightness","brightness","BrightnessContrastGimp","contrast","p4","tan","BrightnessContrastPhotoshop","Channels","channel","ColorMatrixFilter","Copy","CloneBuiltin","m0","m3","m4","m5","m6","m7","m8","m9","m10","m11","m12","m13","m14","m15","m16","m17","m18","m19","ColorTransformFilter","redMultiplier","greenMultiplier","blueMultiplier","alphaMultiplier","redOffset","greenOffset","blueOffset","alphaOffset","Crop","srcRow","srcCol","srcLeft","srcTop","srcRight","srcBottom","dstLeft","dstTop","dstRow","dstCol","CropBuiltin","Desaturate","DisplacementMapFilter","mapImageData","mapX","mapY","componentX","componentY","mode","mapIndex","tx","ty","mapWidth","mapHeight","mapPixels","mapRight","mapBottom","Dither","levels","posterize","levelMap","levelsMinus1","j","ret","old_r","old_g","old_b","new_r","new_g","new_b","err_r","err_g","err_b","nbr_r","nbr_g","nbr_b","srcWidthMinus1","srcHeightMinus1","A","B","C","D","Edge","Emboss","Enrich","Flip","vertical","Gamma","gamma","GrayScale","intensity","HSLAdjustment","hueDelta","satDelta","lightness","hsl","Invert","Mosaic","blockSize","x_start","x_end","y_start","y_end","yIndex","ceil","Oil","sr","sg","sb","ri","gi","bi","rh","gh","bh","rt","gt","bt","OpacityFilter","opacity","Posterize","Rescale","scale","ResizeNearestNeighbor","xFactor","yFactor","Resize","ResizeBuiltin","Sepia","Sharpen","factor","Solarize","Transpose","Twril","centerX","centerY","smooth","distance","radius2","atan2"],"mappings":"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I,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAC5D,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAC5D,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAC5D,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAC5D,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAC5D,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAC5D,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAC5D,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAC5D,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAC5D,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,KAGxDC,GACC,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAC5D,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAC5D,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAC5D,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAC5D,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAC5D,GAAI,GAAI,GA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","file":"index.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","import opts from './opts'\r\nimport lineData from './lineData'\r\nimport setFilter from './filter'\r\n\r\n// 画布功能\r\nconst arrX = [], // 坐标x\r\n  arrY = [], // 坐标y\r\n  arrN = [], // 笔触点击，移动，放开总次数\r\n  arrColor = [], // 线条颜色\r\n  arrWidth = [], // 线条粗细\r\n  arrNumber = [], // 笔触点击次数\r\n  c_left = opts.oCan.offsetLeft, // canvas的Left,top\r\n  c_top = opts.oCan.offsetTop,\r\n  oCan = opts.oCan,\r\n  ctx = opts.ctx\r\nlet lastX = -1,\r\n  lastY = -1\r\n\r\nfunction addData(data) {\r\n  arrX.push(data.x)\r\n  arrY.push(data.y)\r\n  arrN.push(data.n)\r\n  arrColor.push(data.color)\r\n  arrWidth.push(data.width)\r\n}\r\n\r\n// 绘制\r\nfunction draw(len) {\r\n  ctx.beginPath()\r\n  ctx.lineCap = 'round'\r\n  ctx.lineJoin = 'round'\r\n\r\n  for (let i = 1; i < len; i++) {\r\n    // 线条颜色，粗细\r\n    ctx.lineWidth = arrWidth[i]\r\n    ctx.strokeStyle = arrColor[i]\r\n    lastX = arrX[i]\r\n    lastY = arrY[i]\r\n    if (arrN[i] === 2) {\r\n      // 开头，保存当前的桟\r\n      ctx.beginPath()\r\n      ctx.save()\r\n      ctx.moveTo(lastX, lastY)\r\n    } else {\r\n      ctx.lineTo(lastX, lastY)\r\n    }\r\n    // 绘制线条，释放桟，关闭路线\r\n    ctx.stroke()\r\n    ctx.restore()\r\n  }\r\n  ctx.closePath()\r\n}\r\n\r\n// 重新绘制笔触\r\nfunction cleanDraw() {\r\n  draw(arrN.length)\r\n}\r\n\r\n// 移动\r\nfunction move(e) {\r\n  e.preventDefault()\r\n  const t = e.touches[0]\r\n  // 将计算后的xy位置，添加到数组里\r\n  arrX.push(Math.floor(t.pageX - c_left))\r\n  arrY.push(Math.floor(t.pageY - c_top))\r\n  arrN.push(1)\r\n  arrWidth.push(lineData.w)\r\n  arrColor.push(lineData.color)\r\n  // 绘制\r\n  draw(arrX.length)\r\n}\r\n// 点击\r\nfunction down(e) {\r\n  ctx.clearRect(0, 0, opts.canvasW, opts.cavasH)\r\n  if (!opts.isDraw) {\r\n    return false\r\n  }\r\n  // 重新上传图片，笔触清零\r\n  if (opts.isNewPic) {\r\n    opts.isNewPic = false\r\n    // 笔触记录清零\r\n    arrX.length = 0\r\n    arrY.length = 0\r\n    arrN.length = 0\r\n    arrColor.length = 0\r\n    arrWidth.length = 0\r\n  }\r\n  const t = e.touches[0]\r\n  // 添加到数组，存储\r\n  addData({\r\n    x: t.pageX - c_left,\r\n    y: t.pageY - c_top,\r\n    n: 2,\r\n    color: lineData.color,\r\n    width: lineData.w\r\n  })\r\n  // 记录操作\r\n  arrNumber.push(arrN.length)\r\n  oCan.addEventListener('touchmove', move, false)\r\n}\r\n// 放开\r\nfunction up(e) {\r\n  if (!opts.isDraw) {\r\n    return false\r\n  }\r\n  const t = e.changedTouches[0]\r\n  // 添加到数组，存储\r\n  addData({\r\n    x: t.pageX - c_left,\r\n    y: t.pageY - c_top,\r\n    n: 1,\r\n    color: lineData.color,\r\n    width: lineData.w\r\n  })\r\n  // 取消事件\r\n  oCan.removeEventListener('touchmove', move, false)\r\n}\r\n\r\n// 撤销\r\nfunction revoke() {\r\n  // 如果路线少于0，不会绘制\r\n  if (!arrNumber[arrNumber.length - 1]) {\r\n    return false\r\n  }\r\n  // 获取最后一次笔触的次数\r\n  const len = arrNumber[arrNumber.length - 1]\r\n  arrNumber.pop()\r\n  // 清除对应数量的操作\r\n  arrX.length = len\r\n  arrY.length = len\r\n  arrN.length = len\r\n  arrColor.length = len\r\n  arrWidth.length = len\r\n  ctx.clearRect(0, 0, opts.canvasW, opts.canvasH)\r\n  const data = opts.data\r\n  /*\r\n    重绘流程：\r\n    重新绘制图片 => 渲染滤镜 => 渲染笔触\r\n  */\r\n  ctx.drawImage(data.img, data.imgPos.x, data.imgPos.y, data.imgPos.w, data.imgPos.h)\r\n  setFilter()\r\n  draw(len)\r\n}\r\n\r\n// 添加撤销事件撤销事件\r\nopts.oRevoke.addEventListener('touchstart', revoke)\r\n\r\noCan.addEventListener('touchstart', down, false)\r\noCan.addEventListener('touchend', up, false)\r\n\r\n// 清除笔画功能\r\nexport default cleanDraw\r\n","import opts from './opts'\r\nimport updateDrawStrokes from './draw'\r\nimport ImageFilters from './../../plugins/imagefilters'\r\nimport filterChooseData from './../../utils/filterData'\r\n\r\n// 缓存滤镜信息数据\r\nconst filterData = {\r\n  filter: []\r\n}\r\nconst oFilterBox = document.getElementById('filterBox'), // 滤镜盒子\r\n  oFilterSelect = document.getElementById('filterSelect'), // 选择滤镜select\r\n  oContent = document.querySelector('#filterBox .content')\r\nlet typeName = '', // 当前滤镜效果的名字\r\n  dataList = [] // 当前滤镜效果，子选项值\r\n\r\n/*\r\n  滤镜流程：\r\n  1. 选择好滤镜效果和滤镜的值\r\n  2. 获取渲染滤镜效果的数据\r\n  3. 再渲染到主屏\r\n  4. 绘制笔触效果\r\n*/\r\n\r\n/*\r\n *设置滤镜\r\n *参数\r\n *type: 滤镜类型名字\r\n *imageData: 图片数据\r\n*/\r\nfunction setFilter(type = typeName, imgData = opts.data.imageData) {\r\n  if (!type) {\r\n    return false\r\n  }\r\n  const ctx = opts.ctx\r\n  /*\r\n   *生成滤镜效果\r\n   *参数\r\n   *type: 选择的滤镜效果名字\r\n   *[0]: 图片数据\r\n   *[1]: 滤镜效果的各个数值\r\n  */\r\n  let filtered = ImageFilters[type](imgData, ...filterData.filter),\r\n    pos = opts.data.imgPos\r\n  ctx.clearRect(pos.x, pos.y, pos.w, pos.h)\r\n  ctx.putImageData(filtered, pos.x, pos.y)\r\n  filtered = null\r\n  pos = null\r\n}\r\n\r\n// 更新滤镜选项\r\nfunction updateFilter() {\r\n  // 清空\r\n  filterData.filter.length = 0\r\n  // 将当前input的value值存入filter里面\r\n  dataList.forEach((v) => {\r\n    filterData.filter.push(v.value)\r\n  })\r\n  // 设置\r\n  setFilter(typeName)\r\n  // 绘制笔触\r\n  updateDrawStrokes()\r\n}\r\n\r\n// 将数组格式化成html\r\nfunction format(data) {\r\n  let str = ''\r\n  typeName = data.name\r\n  data.chooseValue.forEach((v, i) => {\r\n    const _range = data.range\r\n    str += `<div class='list'>\r\n      <span>${v}</span><input type='range' max='${_range[i].max}' min='${_range[i].min}' value='${_range[i].first}' id='${v}' /><span>${_range[i].first}</span>\r\n    </div>`\r\n  })\r\n  return str\r\n}\r\n\r\n// box change事件\r\noFilterBox.addEventListener('change', (e) => {\r\n  const tar = e.target\r\n  // 事件委托，获取到当前对象\r\n  if (tar.getAttribute('type') === 'range') {\r\n    // 当range值更改后，渲染滤镜\r\n    updateFilter()\r\n  }\r\n}, false)\r\n\r\n// box input事件\r\noFilterBox.addEventListener('input', (e) => {\r\n  const tar = e.target\r\n  // 事件委托，获取到当前对象\r\n  if (tar.getAttribute('type') === 'range') {\r\n    // 拖动滚动条时，显示当前的value值\r\n    tar.nextSibling.innerHTML = tar.value\r\n  }\r\n})\r\n\r\noFilterBox.addEventListener('touchstart', () => {\r\n  opts.isStopPrevent = false\r\n}, false)\r\n\r\n// 选择滤镜效果\r\noFilterSelect.addEventListener('change', function() {\r\n  opts.isStopPrevent = true\r\n  // 获取选择的滤镜效果数据\r\n  const arr = filterChooseData.filterValue.filter((v) => {\r\n    return v.name === this.value\r\n  })\r\n  if (!arr) {\r\n    return false\r\n  }\r\n  // 格式化内容，生成range组件\r\n  oContent.innerHTML = format(arr[0])\r\n  // 获取input对象数组\r\n  const aInput = [...document.querySelectorAll('#filterBox .content input')]\r\n  // 缓存input对象\r\n  dataList = aInput.filter((v) => {\r\n    return v.nodeName === 'INPUT'\r\n  })\r\n  updateFilter()\r\n}, false)\r\n\r\n// 渲染当前选择好的滤镜效果\r\nexport default setFilter\r\n","import opts from './opts'\r\nimport ColorPicker from './../../plugins/colorPicker'\r\n\r\nconst output = { color: '#000000', w: 5 }\r\n// 画布的线的，数据（）\r\ndocument.addEventListener('DOMContentLoaded', () => {\r\n  const oP = document.querySelector('.rangeWrap p')\r\n  const oColorBtn = document.querySelector('.colorBtn'),\r\n    oColorBox = document.querySelector('.colorPickerbox')\r\n  let colorOnoff = true\r\n\r\n  // 模拟range\r\n  const oRange = document.querySelector('.rangeBtn'),\r\n    oRangePar = document.querySelector('.rangeLine'),\r\n    r_opts = {\r\n      h: oRangePar.offsetHeight,\r\n      t: oRangePar.offsetTop,\r\n      rH: oRange.offsetHeight,\r\n      max: 10,\r\n      min: 1,\r\n      size: 1,\r\n      num: 0\r\n    }\r\n\r\n  function rangeMove(e) {\r\n    const t = e.touches[0]\r\n    let my = t.clientY - r_opts.t\r\n    if (my <= 0) {\r\n      my = 0\r\n    } else if (my >= r_opts.h) {\r\n      my = r_opts.h\r\n    }\r\n\r\n    opts.transform(oRange, ('translateY(' + my + 'px)'))\r\n    r_opts.my = my\r\n    // 判断当前位置，属于几\r\n    const value = Math.floor(my / r_opts.num)\r\n    output.w = value\r\n    oP.innerHTML = '宽度：' + value\r\n  }\r\n\r\n  // 颜色选择器\r\n  const colorPicker = new ColorPicker({\r\n    oBox: oColorBox,\r\n    oBtnWrap: document.querySelector('.btnWrap'),\r\n    oCan: document.querySelector('#colorPicker'),\r\n    width: 200,\r\n    height: 200,\r\n    callback: (color) => {\r\n      output.color = color\r\n      oColorBtn.style.background = color\r\n    }\r\n  })\r\n\r\n  colorPicker.init()\r\n\r\n  oColorBtn.addEventListener('touchstart', () => {\r\n    opts.transform(oColorBox, 'translateX(' + (colorOnoff ? 0 : -1000) + 'px)')\r\n    colorOnoff = !colorOnoff\r\n  }, false)\r\n\r\n  oRange.addEventListener('touchstart', (e) => {\r\n    e.stopPropagation()\r\n    const t = e.touches[0]\r\n    r_opts.fx = t.clientX\r\n    r_opts.fy = t.clientY\r\n\r\n    r_opts.h = oRangePar.offsetHeight\r\n    r_opts.t = oRangePar.offsetTop\r\n    r_opts.rH = oRange.offsetHeight\r\n    // 修正高度\r\n    r_opts.h -= r_opts.rH\r\n    // 份数\r\n    r_opts.num = r_opts.h / r_opts.max\r\n    // 添加移动事件\r\n    oRange.addEventListener('touchmove', rangeMove, false)\r\n  }, false)\r\n\r\n  oRange.addEventListener('touchend', () => {\r\n    // 移除移动事件\r\n    oRange.removeEventListener('touchmove', rangeMove, false)\r\n  }, false)\r\n}, false)\r\n\r\nexport default output\r\n","// 入口文件\r\nimport Fastclick from './../../plugins/fastclick'\r\nimport _opts from './opts'\r\nimport './photograph'\r\nimport './draw'\r\nimport './lineData'\r\nimport './filter'\r\nimport './selectImgSize'\r\n// 添加fastclick\r\ndocument.addEventListener('DOMContentLoaded', () => {\r\n  Fastclick.attach(document.body)\r\n}, false)\r\n\r\ndocument.querySelector('.main').addEventListener('touchmove', (e) => {\r\n  if (_opts.isStopPrevent) {\r\n    e.preventDefault()\r\n  }\r\n}, false)\r\n\r\nconst oFilterBox = document.getElementById('filterBox')\r\n\r\n// 滤镜框显示隐藏\r\ndocument.getElementById('filterBtn').addEventListener('touchstart', () => {\r\n  oFilterBox.style.display = 'block'\r\n}, false)\r\n\r\ndocument.querySelector('#filterBox .close').addEventListener('touchstart', () => {\r\n  oFilterBox.style.display = 'none'\r\n}, false)\r\n\r\nconst oTop = document.querySelector('.main_top')\r\n\r\n_opts.canvasW = oTop.offsetWidth\r\n_opts.canvasH = oTop.offsetHeight\r\n\r\n// 初始化，定义画布宽高\r\nconst oCan = _opts.oCan\r\noCan.width = _opts.canvasW\r\noCan.height = _opts.canvasH\r\n","// 将对象存储在内存中\r\nconst oCan = document.getElementById('canvas'), // 获取画布\r\n  ctx = oCan.getContext('2d'),\r\n  oShowImg = document.getElementById('lastImg'), // 最终生成的图片\r\n  oMsg = document.querySelector('.msg'),\r\n  oZhezhao = document.querySelector('.zhezhao'),\r\n  oRevoke = document.getElementById('revoke') // 撤销按钮  \r\n\r\n// 公共方法\r\nfunction showLoading(type) {\r\n  oZhezhao.style.display = type\r\n  oMsg.style.display = type\r\n}\r\n\r\nexport default {\r\n  // 对象\r\n  oCan: oCan,\r\n  ctx: ctx,\r\n  oShowImg: oShowImg,\r\n  oMsg: oMsg,\r\n  oZhezhao: oZhezhao,\r\n  oRevoke: oRevoke,\r\n  // 方法\r\n  showLoading: showLoading,\r\n  isDraw: false, // 能否涂鸦\r\n  isNewPic: true, // 是否新的图片\r\n  isStopPrevent: true, // 是否阻止全局默认事件\r\n  data: {},\r\n  imgData: {},\r\n  // 兼容写法\r\n  transform: (obj, data) => {\r\n    obj.style.WebkitTransform = data\r\n    obj.style.transform = data\r\n  }\r\n}\r\n","import EXIF from './../../plugins/exif'\r\nimport opts from './opts'\r\n\r\nconst oCan = opts.oCan,\r\n  ctx = opts.ctx,\r\n  oAsideBtn = document.querySelector('.asideBtn'),\r\n  oAside = document.querySelector('#aside'),\r\n  oFile = document.getElementById('file'), // 上传图片按钮\r\n  oCreateBtn = document.getElementById('create'), // 生成图片按钮\r\n  imgData = {}\r\n\r\nlet isCreatePic = false // 是否生成了图片\r\n\r\n/*\r\n *图片上传处理过程\r\n *图片上传成功后 => 获取元数据 => 转化为base64 => 修正图片的宽高，显示的方向和图片的内存大小\r\n*/\r\n\r\n// 生成图片\r\nfunction createImg(e) {\r\n  e.preventDefault()\r\n  if (!isCreatePic) {\r\n    return false\r\n  }\r\n  // 删除上传图片按钮\r\n  oFile.parentNode.removeChild(oFile)\r\n  this.parentNode.removeChild(this)\r\n  oCan.style.display = 'none'\r\n  this.style.display = 'block'\r\n  // 生成图片\r\n  opts.oShowImg.src = oCan.toDataURL('image/png')\r\n  opts.oShowImg.style.display = 'block'\r\n  opts.oShowImg.style.position = 'static'\r\n  $.post('/api/savePic', {id: document.querySelector('#user').getAttribute('userId'), url: opts.oShowImg.src}, (data) => {\r\n    console.log(data)\r\n  })\r\n  document.querySelector('.main_bottom').innerHTML = '<p class=\"success_txt\">生成图片成功！长按可保存图片</p>'\r\n}\r\n\r\n// 图片load回调方法\r\nfunction cacheImg(url, callback) {\r\n  console.log('load')\r\n  if (!url) {\r\n    callback.call()\r\n    return false\r\n  }\r\n  const img = new Image()\r\n  // img.crossOrigin = \"Anonymous\"\r\n  img.onload = () => {\r\n    // 图片加载完，执行回调\r\n    callback.call(img)\r\n  }\r\n  img.src = url\r\n}\r\n\r\n// 显示功能\r\nfunction showFun() {\r\n  opts.showLoading('none')\r\n  // 选择size，笔触颜色显示\r\n  oAsideBtn.style.display = 'block'\r\n  oCreateBtn.style.display = 'block'\r\n  document.getElementById('filterBtn').style.display = 'block'\r\n  // 撤销按钮小时\r\n  opts.oRevoke.style.display = 'block'\r\n  isCreatePic = true\r\n  // 是否可以画笔触\r\n  opts.isDraw = true\r\n  // 是新的图片\r\n  opts.isNewPic = true\r\n}\r\n\r\n// 使用离屏进行计算\r\n// function offScreen() {\r\n// }\r\n\r\n// 计算图片的宽高\r\nfunction computeWidthAndHeight(data) {\r\n  let drawWidth = data.drawWidth,\r\n    drawHeight = data.drawHeight,\r\n    degree = 0,\r\n    maxSide = Math.max(drawWidth, drawHeight)\r\n  const params = data.params,\r\n    size = 2048\r\n\r\n  // 如果当期size大于2M，按比例修正到2M以下\r\n  if (maxSide > size) {\r\n    let minSide = Math.min(drawWidth, drawHeight)\r\n    minSide = minSide / maxSide * size\r\n    maxSide = size\r\n    if (drawWidth > drawHeight) {\r\n      drawWidth = maxSide\r\n      drawHeight = minSide\r\n    } else {\r\n      drawWidth = minSide\r\n      drawHeight = maxSide\r\n    }\r\n  }\r\n  // 使用离屏canvas修正图片的方向\r\n  const canvas = document.createElement('canvas')\r\n  const width = drawWidth,\r\n    height = drawHeight\r\n  canvas.width = width\r\n  canvas.height = height\r\n\r\n  const context = canvas.getContext('2d')\r\n  // 判断图片方向，重置canvas大小，确定旋转角度，iphone默认的是home键在右方的横屏拍摄方式\r\n  switch (params.data.Orientation) {\r\n  // iphone横屏拍摄，此时home键在左侧\r\n  case 3:\r\n    degree = 180\r\n    drawWidth = -width\r\n    drawHeight = -height\r\n    break\r\n    // iphone竖屏拍摄，此时home键在下方(正常拿手机的方向)\r\n  case 6:\r\n    canvas.width = height\r\n    canvas.height = width\r\n    degree = 90\r\n    drawWidth = width\r\n    drawHeight = -height\r\n    break\r\n    // iphone竖屏拍摄，此时home键在上方\r\n  case 8:\r\n    canvas.width = height\r\n    canvas.height = width\r\n    degree = 270\r\n    drawWidth = -width\r\n    drawHeight = height\r\n    break\r\n  }\r\n  /*\r\n   *返回参数\r\n   *degress: 渲染的方向\r\n   *drawWidth: 修正后的宽度\r\n   *.......\r\n  */\r\n  return {\r\n    degree: degree,\r\n    drawWidth: drawWidth,\r\n    drawHeight: drawHeight,\r\n    context: context,\r\n    canvas: canvas\r\n  }\r\n}\r\n\r\n// 获取处理好的图片数据\r\nfunction getImgData(params) {\r\n  cacheImg(params.img, function() {\r\n    // 以下改变一下图片大小\r\n    // 获取宽高中，最大的值\r\n    let output = computeWidthAndHeight({\r\n      drawWidth: params.data.PixelXDimension || this.naturalWidth,\r\n      drawHeight: params.data.PixelYDimension || this.naturalHeight,\r\n      params: params\r\n    })\r\n    // 使用canvas旋转校正\r\n    output.context.rotate(output.degree * Math.PI / 180)\r\n    // 渲染新的图片\r\n    output.context.drawImage(this, 0, 0, output.drawWidth, output.drawHeight)\r\n    // 生成校正后图片\r\n    params.next(output.canvas.toDataURL('image/png'))\r\n    output = null\r\n  })\r\n}\r\n\r\n// 处理修正后的图片，渲染到屏幕上\r\nfunction uploadFileCallBack() {\r\n  // 获取图片的宽高\r\n  let w = this.width,\r\n    h = this.height\r\n  // 缓存图片初始宽高\r\n  imgData.w = w\r\n  imgData.h = h\r\n  opts.imgData.w = w\r\n  opts.imgData.h = h\r\n  const cW = opts.canvasW,\r\n    cH = opts.canvasH\r\n  if (cW / cH > w / h) {\r\n    // 宽大于高，高100%\r\n    w = w * cH / h\r\n    h = cH\r\n  } else {\r\n    // 高大于宽，宽100%\r\n    h = h * cW / w\r\n    w = cW\r\n  }\r\n  ctx.clearRect(0, 0, cW, cH)\r\n  // 生成图片，居中显示\r\n  ctx.drawImage(this, (cW - w) / 2, (cH - h) / 2, w, h)\r\n  // 缓存当前图片的数据到内存里\r\n  opts.data.imageData = ctx.getImageData((cW - w) / 2, (cH - h) / 2, w, h)\r\n  opts.data.img = this\r\n  opts.data.imgPos = {\r\n    x: (cW - w) / 2,\r\n    y: (cH - h) / 2,\r\n    w: w,\r\n    h: h\r\n  }\r\n  showFun()\r\n}\r\n\r\n// 图片上传回调事件\r\nfunction uploadFile() {\r\n  const file = this.files[0]\r\n  let exifData = null\r\n  // 判断图片是否过大\r\n  if (file.size / 1024 > 5000) {\r\n    // 大于2M\r\n    alert('图片过大，请选择相对较小的图片')\r\n    return false\r\n  }\r\n  // 图片处理中，提示层出现\r\n  opts.showLoading('block')\r\n  const reader = new FileReader()\r\n  new Promise((resolve) => {\r\n  // 获取图片的元数据\r\n    EXIF.getData(file, function() {\r\n      exifData = EXIF.getAllTags(this)\r\n      resolve()\r\n    })\r\n  }).then(() => {\r\n    reader.onload = function() {\r\n      // 图片信息获取完毕\r\n      // 修正图片方向\r\n      getImgData({\r\n        img: this.result,\r\n        data: exifData,\r\n        next: (img) => {\r\n          cacheImg(img, uploadFileCallBack)\r\n        }\r\n      })\r\n    }\r\n    reader.readAsDataURL(file)\r\n  })\r\n}\r\n\r\n// 图片上传后，change事件\r\noFile.addEventListener('change', uploadFile, false)\r\n\r\n// 生成图片\r\noCreateBtn.addEventListener('touchstart', createImg, false)\r\n\r\n// 侧边栏显示\r\noAsideBtn.addEventListener('touchstart', () => {\r\n  if (!isCreatePic) {\r\n    alert('请先选择图片')\r\n    return false\r\n  }\r\n  opts.isDraw = false\r\n  oAside.style.display = 'block'\r\n})\r\n// 侧边栏隐藏\r\ndocument.querySelector('.aside_hideBtn').addEventListener('touchstart', () => {\r\n  opts.isDraw = true\r\n  oAside.style.display = 'none'\r\n  opts.transform(document.querySelector('.colorPickerbox'), 'translateX(-1000px)')\r\n})\r\n","import updateDrawStrokes from './draw'\r\nimport setFilter from './filter'\r\nimport opts from './opts'\r\n\r\nconst ctx = opts.ctx\r\n\r\n// 改变图片展示方式\r\nfunction selectPicSize(value) {\r\n  let set_x,\r\n    set_y,\r\n    set_w,\r\n    set_h,\r\n    w = opts.imgData.w,\r\n    h = opts.imgData.h\r\n  const cw = opts.canvasW,\r\n    ch = opts.canvasH\r\n\r\n  function check_type(type) {\r\n    if (type) {\r\n      if (cw / ch > w / h) {\r\n        // 宽大于高，高100%\r\n        w = w * ch / h\r\n        h = ch\r\n      } else {\r\n        h = h * cw / w\r\n        w = cw\r\n      }\r\n    } else {\r\n      if (cw / ch <= w / h) {\r\n        // 宽大于高，高100%\r\n        w = w * ch / h\r\n        h = ch\r\n      } else {\r\n        h = h * cw / w\r\n        w = cw\r\n      }\r\n    }\r\n  }\r\n  // 改变图片展示方式\r\n  switch (value) {\r\n  case '1':\r\n    // 居中\r\n    check_type(true)\r\n    set_x = (cw - w) / 2\r\n    set_y = (ch - h) / 2\r\n    set_w = w\r\n    set_h = h\r\n    break\r\n  case '2':\r\n    // 填充\r\n    check_type(false)\r\n    set_x = (cw - w) / 2\r\n    set_y = (ch - h) / 2\r\n    set_w = w\r\n    set_h = h\r\n    break\r\n  case '3':\r\n    // 适应\r\n    check_type(true)\r\n    set_x = 0\r\n    set_y = 0\r\n    set_w = w\r\n    set_h = h\r\n    break\r\n  case '4':\r\n    // 拉伸\r\n    set_x = 0\r\n    set_y = 0\r\n    set_w = cw\r\n    set_h = ch\r\n    break\r\n  default:\r\n    // 居中\r\n    check_type(true)\r\n    set_x = (cw - w) / 2\r\n    set_y = (ch - h) / 2\r\n    set_w = w\r\n    set_h = h\r\n    break\r\n  }\r\n  return {\r\n    set_x: set_x,\r\n    set_y: set_y,\r\n    set_w: set_w,\r\n    set_h: set_h\r\n  }\r\n}\r\n// 选择图片的显示方式\r\ndocument.getElementById('selectPicSize').addEventListener('change', function() {\r\n  // 获取上传的图片\r\n  let img = opts.data.img\r\n  // 获取修正后的宽高,xy\r\n  const output = selectPicSize(this.value)\r\n  const set_x = output.set_x,\r\n    set_y = output.set_y,\r\n    set_w = output.set_w,\r\n    set_h = output.set_h\r\n  // 重绘\r\n  ctx.clearRect(0, 0, opts.canvasW, opts.canvasH)\r\n  ctx.drawImage(img, set_x, set_y, set_w, set_h)\r\n  opts.data.imageData = ctx.getImageData(set_x, set_y, set_w, set_h)\r\n  opts.data.imgPos = {\r\n    x: set_x,\r\n    y: set_y,\r\n    w: set_w,\r\n    h: set_h\r\n  }\r\n  img = null\r\n  setFilter()\r\n  updateDrawStrokes()\r\n}, false)\r\n","function ColorPicker(params) {\r\n  this.oBox = params.oBox//最外层盒子\r\n  this.oBtnWrap = params.oBtnWrap//按钮外层盒子\r\n  this.oCan = params.oCan//画布\r\n  this.ctx = params.oCan.getContext('2d')\r\n\r\n  this.w = params.width//画布的宽高\r\n  this.h = params.width\r\n  this.lineW = 20 //外层颜色的厚度\r\n  this.r = this.w / 2 //外圆半径\r\n  this.r2 = this.r - this.lineW //内圆半径\r\n    //内层颜色宽高,坐标\r\n  this.iW = (this.r2 - 5) / Math.cos(2 * Math.PI / 360 * 45)\r\n  this.iX = (this.w - this.iW) / 2\r\n    //canvas的Left top值\r\n  this.where = '' //点击时的位置\r\n    //属性\r\n  this.opts = {\r\n    insideX: 0,\r\n    insideY: 0\r\n  }\r\n  this.callback = params.callback;\r\n  this.bindMove = null;\r\n}\r\n\r\nColorPicker.prototype = {\r\n  init: function() {\r\n    //初始化\r\n    this.oCan.width = this.w;\r\n    this.oCan.height = this.h;\r\n    //生成节点（内外层选择点）\r\n    this.oBtnWrap.innerHTML = '<div class=\"insideBtn\"></div><div class=\"outsideBtn\"></div>';\r\n    //两个颜色选择点\r\n    this.oInsideBtn = document.querySelector(\".insideBtn\");\r\n    this.oOutsideBtn = document.querySelector(\".outsideBtn\");\r\n    //按钮宽度\r\n    this.btnW = this.oInsideBtn.offsetWidth;\r\n    \r\n    var x = this.w / 2,\r\n      y = this.h / 2,\r\n      _this = this,\r\n      r2 = this.r2\r\n    //按钮位置初始化\r\n    this.transform(this.oInsideBtn, 'translate(' + (this.iW + this.iX - this.btnW) + 'px ,' + this.iX + 'px)');\r\n    this.transform(this.oOutsideBtn, 'translate(' + x + 'px ,' + 0 + 'px)');\r\n    this.opts.insideX = this.iW + this.iX - this.btnW;\r\n    this.opts.insideY = this.iX;\r\n    //生成外层颜色\r\n    this.createColorBg(x,y);\r\n\r\n    //生成内颜色\r\n    this.createInsideColor('red');\r\n    var move = _this.move.bind(this);\r\n    this.bindMove = this.move.bind(this);\r\n    //给予事件\r\n    //pc端\r\n    this.oBox.addEventListener('mousedown', this.addMove.bind(this), false);\r\n    this.oBox.addEventListener('mouseup', this.removeMove.bind(this), false);\r\n\r\n    //移动端\r\n    this.oCan.addEventListener('touchstart', this.addMove.bind(this), false);\r\n    this.oCan.addEventListener('touchend', this.removeMove.bind(this), false);\r\n  },\r\n  addMove:function(e){\r\n    //获取canvas的left ,top 位置\r\n    if (!this.oCan_left) {\r\n      var canPos = this.getElemPos(this.oCan)\r\n      this.oCan_left = canPos.x\r\n      this.oCan_top = canPos.y\r\n    }\r\n    //颜色初始化\r\n    this.move(e);\r\n    document.addEventListener('mousemove', this.bindMove, false);\r\n    document.addEventListener('touchmove', this.bindMove, false);\r\n  },\r\n  removeMove:function(){\r\n    console.log('out')\r\n    document.removeEventListener('mousemove', this.bindMove, false);\r\n    document.removeEventListener('touchmove', this.bindMove, false);\r\n  },\r\n  createColorBg:function(x,y){\r\n    //生成圆环颜色\r\n    var ctx = this.ctx;\r\n    for (var i = 0; i < 360; i += .1) {\r\n      //获取度数\r\n      var rad = i * (2 * Math.PI) / 360,\r\n        c_x = Math.cos(rad),\r\n        c_y = Math.sin(rad),\r\n        lineW = this.lineW\r\n      ctx.strokeStyle = \"hsl(\" + i + \", 100%, 50%)\";\r\n      ctx.beginPath();\r\n      ctx.moveTo(x + (x - lineW) * c_x, y + (y - lineW) * c_y);\r\n      //求出另外两点坐标\r\n      ctx.lineTo(x + x * c_x, y + y * c_y);\r\n      ctx.stroke();\r\n      ctx.closePath();\r\n    }\r\n  },\r\n  createInsideColor: function(color) {\r\n    //生成内颜色\r\n    var ctx = this.ctx,\r\n      w = this.w,\r\n      h = this.h,\r\n      iW = this.iW,\r\n      iX = this.iX //起点坐标\r\n      //清除指定区域\r\n    ctx.clearRect(iX, iX, iW, iW)\r\n    ctx.fillStyle = color\r\n    ctx.fillRect(iX, iX, iW, iW)\r\n      //白色\r\n    var g = ctx.createLinearGradient(iX, (iX + iW) / 2, iX + iW, (iX + iW) / 2)\r\n    g.addColorStop(0, \"#FFFFFF\")\r\n    g.addColorStop(1, \"rgba(255,255,255,0)\");\r\n    ctx.fillStyle = g;\r\n    ctx.fillRect(iX, iX, iW, iW);\r\n\r\n    //黑色\r\n    var g = ctx.createLinearGradient(iX, iX + iW, iX, iX)\r\n    g.addColorStop(0, \"#000000\")\r\n    g.addColorStop(1, \"rgba(0,0,0,0)\");\r\n    ctx.fillStyle = g;\r\n    ctx.fillRect(iX, iX, iW, iW);\r\n  },\r\n  move: function(e) {\r\n    //移动事件\r\n    var t = e.touches ? e.touches[0] : e,\r\n      x = t.pageX - this.oCan_left,\r\n      y = t.pageY - this.oCan_top\r\n    var pos = this.btnPosition(x, y);\r\n    if (!pos) {\r\n      return false; }\r\n\r\n    var where = this.where,\r\n      color = '';\r\n    this.transform(where === 'outside' ? this.oOutsideBtn : this.oInsideBtn, 'translate(' + pos.x + 'px ,' + pos.y + 'px)');\r\n    color = this.getColor(pos.x, pos.y);\r\n    if (where === 'outside') {\r\n      //如果是外层，改变内层颜色\r\n      this.createInsideColor(color);\r\n      color = this.getColor(this.opts.insideX, this.opts.insideY);\r\n    }\r\n    this.callback && this.callback(color);\r\n  },\r\n  btnPosition: function(x, y) {\r\n    //判断外按钮位置\r\n    var w = this.w,\r\n      h = this.h,\r\n      iW = this.iW,\r\n      iX = this.iX;\r\n\r\n    //获取圆心到点的距离\r\n    var d = Math.sqrt(Math.pow((x - w / 2), 2) + Math.pow((y - h / 2), 2))\r\n      //判断在内层颜色内\r\n    if ((x > iX && x < iX + iW) && (y > iX && y < iX + iW)) {\r\n      this.where = 'inside'\r\n    } else if (d >= this.r2 && d <= this.r) {\r\n      //判断在外层颜色内\r\n      this.where = 'outside'\r\n    } else {\r\n      console.log('no')\r\n      return false;\r\n    }\r\n    var where = this.where,\r\n      btnW = this.btnW,\r\n      btnW2 = btnW / 2\r\n      //计算是否有超出\r\n    if (where === 'outside') {\r\n      if (x < btnW2) {\r\n        x = 0\r\n      } else if (x > w - btnW2) {\r\n        x = w - btnW\r\n      }\r\n      if (y < btnW2) {\r\n        y = 0\r\n      } else if (y > h - btnW2) {\r\n        y = h - btnW\r\n      }\r\n    } else {\r\n      var x1 = iX - btnW2,\r\n        y1 = iW + iX - btnW2,\r\n        y2 = iW + iX - btnW\r\n      if (x < x1) {\r\n        x = iX\r\n      } else if (x > y1) {\r\n        x = y2;\r\n      }\r\n      if (y < x1) {\r\n        y = iX\r\n      } else if (y > y1) {\r\n        y = y2\r\n      }\r\n\r\n      this.opts.insideX = x;\r\n      this.opts.insideY = y;\r\n    }\r\n    return {\r\n      x: x,\r\n      y: y\r\n    }\r\n  },\r\n  transform: function(obj, data) {\r\n    obj.style.WebkitTransform = data;\r\n    obj.style.transform = data;\r\n  },\r\n  getColor: function(x, y) {\r\n    var pixel = this.ctx.getImageData(x, y, 1, 1),\r\n      data = pixel.data,\r\n      rgb = 'rgb(' + data[0] + ',' + data[1] +\r\n      ',' + data[2] + ')';\r\n    return rgb\r\n  },\r\n  getElemPos: function(obj) {\r\n    //获取目标，到最外层的offsetLeft和offsetTop\r\n    var pos = {\r\n      \"top\": 0,\r\n      \"left\": 0\r\n    };\r\n    if (obj.offsetParent) {\r\n      while (obj.offsetParent) {\r\n        pos.top += obj.offsetTop;\r\n        pos.left += obj.offsetLeft;\r\n        obj = obj.offsetParent;\r\n      }\r\n    } else if (obj.x) {\r\n      pos.left += obj.x;\r\n    } else if (obj.x) {\r\n      pos.top += obj.y;\r\n    }\r\n    return {\r\n      x: pos.left,\r\n      y: pos.top\r\n    };\r\n  }\r\n}\r\n\r\nexport default ColorPicker\r\n\r\n  //声明模块\r\n  // if (typeof define === 'function' && typeof define.amd === 'object' && define.amd) {\r\n  //   define(function() {\r\n  //     return ColorPicker;\r\n  //   });\r\n  // } else if (typeof module !== 'undefined' && module.exports) {\r\n  //   module.exports.ColorPicker = ColorPicker;\r\n  // } else {\r\n  //   window.ColorPicker = ColorPicker;\r\n  // }\r\n\r\n\r\n\r\n","(function() {\r\n\r\n    var debug = false;\r\n\r\n    var root = this;\r\n\r\n    var EXIF = function(obj) {\r\n        if (obj instanceof EXIF) return obj;\r\n        if (!(this instanceof EXIF)) return new EXIF(obj);\r\n        this.EXIFwrapped = obj;\r\n    };\r\n\r\n    if (typeof exports !== 'undefined') {\r\n        if (typeof module !== 'undefined' && module.exports) {\r\n            exports = module.exports = EXIF;\r\n        }\r\n        exports.EXIF = EXIF;\r\n    } else {\r\n        root.EXIF = EXIF;\r\n    }\r\n\r\n    var ExifTags = EXIF.Tags = {\r\n\r\n        // version tags\r\n        0x9000 : \"ExifVersion\",             // EXIF version\r\n        0xA000 : \"FlashpixVersion\",         // Flashpix format version\r\n\r\n        // colorspace tags\r\n        0xA001 : \"ColorSpace\",              // Color space information tag\r\n\r\n        // image configuration\r\n        0xA002 : \"PixelXDimension\",         // Valid width of meaningful image\r\n        0xA003 : \"PixelYDimension\",         // Valid height of meaningful image\r\n        0x9101 : \"ComponentsConfiguration\", // Information about channels\r\n        0x9102 : \"CompressedBitsPerPixel\",  // Compressed bits per pixel\r\n\r\n        // user information\r\n        0x927C : \"MakerNote\",               // Any desired information written by the manufacturer\r\n        0x9286 : \"UserComment\",             // Comments by user\r\n\r\n        // related file\r\n        0xA004 : \"RelatedSoundFile\",        // Name of related sound file\r\n\r\n        // date and time\r\n        0x9003 : \"DateTimeOriginal\",        // Date and time when the original image was generated\r\n        0x9004 : \"DateTimeDigitized\",       // Date and time when the image was stored digitally\r\n        0x9290 : \"SubsecTime\",              // Fractions of seconds for DateTime\r\n        0x9291 : \"SubsecTimeOriginal\",      // Fractions of seconds for DateTimeOriginal\r\n        0x9292 : \"SubsecTimeDigitized\",     // Fractions of seconds for DateTimeDigitized\r\n\r\n        // picture-taking conditions\r\n        0x829A : \"ExposureTime\",            // Exposure time (in seconds)\r\n        0x829D : \"FNumber\",                 // F number\r\n        0x8822 : \"ExposureProgram\",         // Exposure program\r\n        0x8824 : \"SpectralSensitivity\",     // Spectral sensitivity\r\n        0x8827 : \"ISOSpeedRatings\",         // ISO speed rating\r\n        0x8828 : \"OECF\",                    // Optoelectric conversion factor\r\n        0x9201 : \"ShutterSpeedValue\",       // Shutter speed\r\n        0x9202 : \"ApertureValue\",           // Lens aperture\r\n        0x9203 : \"BrightnessValue\",         // Value of brightness\r\n        0x9204 : \"ExposureBias\",            // Exposure bias\r\n        0x9205 : \"MaxApertureValue\",        // Smallest F number of lens\r\n        0x9206 : \"SubjectDistance\",         // Distance to subject in meters\r\n        0x9207 : \"MeteringMode\",            // Metering mode\r\n        0x9208 : \"LightSource\",             // Kind of light source\r\n        0x9209 : \"Flash\",                   // Flash status\r\n        0x9214 : \"SubjectArea\",             // Location and area of main subject\r\n        0x920A : \"FocalLength\",             // Focal length of the lens in mm\r\n        0xA20B : \"FlashEnergy\",             // Strobe energy in BCPS\r\n        0xA20C : \"SpatialFrequencyResponse\",    //\r\n        0xA20E : \"FocalPlaneXResolution\",   // Number of pixels in width direction per FocalPlaneResolutionUnit\r\n        0xA20F : \"FocalPlaneYResolution\",   // Number of pixels in height direction per FocalPlaneResolutionUnit\r\n        0xA210 : \"FocalPlaneResolutionUnit\",    // Unit for measuring FocalPlaneXResolution and FocalPlaneYResolution\r\n        0xA214 : \"SubjectLocation\",         // Location of subject in image\r\n        0xA215 : \"ExposureIndex\",           // Exposure index selected on camera\r\n        0xA217 : \"SensingMethod\",           // Image sensor type\r\n        0xA300 : \"FileSource\",              // Image source (3 == DSC)\r\n        0xA301 : \"SceneType\",               // Scene type (1 == directly photographed)\r\n        0xA302 : \"CFAPattern\",              // Color filter array geometric pattern\r\n        0xA401 : \"CustomRendered\",          // Special processing\r\n        0xA402 : \"ExposureMode\",            // Exposure mode\r\n        0xA403 : \"WhiteBalance\",            // 1 = auto white balance, 2 = manual\r\n        0xA404 : \"DigitalZoomRation\",       // Digital zoom ratio\r\n        0xA405 : \"FocalLengthIn35mmFilm\",   // Equivalent foacl length assuming 35mm film camera (in mm)\r\n        0xA406 : \"SceneCaptureType\",        // Type of scene\r\n        0xA407 : \"GainControl\",             // Degree of overall image gain adjustment\r\n        0xA408 : \"Contrast\",                // Direction of contrast processing applied by camera\r\n        0xA409 : \"Saturation\",              // Direction of saturation processing applied by camera\r\n        0xA40A : \"Sharpness\",               // Direction of sharpness processing applied by camera\r\n        0xA40B : \"DeviceSettingDescription\",    //\r\n        0xA40C : \"SubjectDistanceRange\",    // Distance to subject\r\n\r\n        // other tags\r\n        0xA005 : \"InteroperabilityIFDPointer\",\r\n        0xA420 : \"ImageUniqueID\"            // Identifier assigned uniquely to each image\r\n    };\r\n\r\n    var TiffTags = EXIF.TiffTags = {\r\n        0x0100 : \"ImageWidth\",\r\n        0x0101 : \"ImageHeight\",\r\n        0x8769 : \"ExifIFDPointer\",\r\n        0x8825 : \"GPSInfoIFDPointer\",\r\n        0xA005 : \"InteroperabilityIFDPointer\",\r\n        0x0102 : \"BitsPerSample\",\r\n        0x0103 : \"Compression\",\r\n        0x0106 : \"PhotometricInterpretation\",\r\n        0x0112 : \"Orientation\",\r\n        0x0115 : \"SamplesPerPixel\",\r\n        0x011C : \"PlanarConfiguration\",\r\n        0x0212 : \"YCbCrSubSampling\",\r\n        0x0213 : \"YCbCrPositioning\",\r\n        0x011A : \"XResolution\",\r\n        0x011B : \"YResolution\",\r\n        0x0128 : \"ResolutionUnit\",\r\n        0x0111 : \"StripOffsets\",\r\n        0x0116 : \"RowsPerStrip\",\r\n        0x0117 : \"StripByteCounts\",\r\n        0x0201 : \"JPEGInterchangeFormat\",\r\n        0x0202 : \"JPEGInterchangeFormatLength\",\r\n        0x012D : \"TransferFunction\",\r\n        0x013E : \"WhitePoint\",\r\n        0x013F : \"PrimaryChromaticities\",\r\n        0x0211 : \"YCbCrCoefficients\",\r\n        0x0214 : \"ReferenceBlackWhite\",\r\n        0x0132 : \"DateTime\",\r\n        0x010E : \"ImageDescription\",\r\n        0x010F : \"Make\",\r\n        0x0110 : \"Model\",\r\n        0x0131 : \"Software\",\r\n        0x013B : \"Artist\",\r\n        0x8298 : \"Copyright\"\r\n    };\r\n\r\n    var GPSTags = EXIF.GPSTags = {\r\n        0x0000 : \"GPSVersionID\",\r\n        0x0001 : \"GPSLatitudeRef\",\r\n        0x0002 : \"GPSLatitude\",\r\n        0x0003 : \"GPSLongitudeRef\",\r\n        0x0004 : \"GPSLongitude\",\r\n        0x0005 : \"GPSAltitudeRef\",\r\n        0x0006 : \"GPSAltitude\",\r\n        0x0007 : \"GPSTimeStamp\",\r\n        0x0008 : \"GPSSatellites\",\r\n        0x0009 : \"GPSStatus\",\r\n        0x000A : \"GPSMeasureMode\",\r\n        0x000B : \"GPSDOP\",\r\n        0x000C : \"GPSSpeedRef\",\r\n        0x000D : \"GPSSpeed\",\r\n        0x000E : \"GPSTrackRef\",\r\n        0x000F : \"GPSTrack\",\r\n        0x0010 : \"GPSImgDirectionRef\",\r\n        0x0011 : \"GPSImgDirection\",\r\n        0x0012 : \"GPSMapDatum\",\r\n        0x0013 : \"GPSDestLatitudeRef\",\r\n        0x0014 : \"GPSDestLatitude\",\r\n        0x0015 : \"GPSDestLongitudeRef\",\r\n        0x0016 : \"GPSDestLongitude\",\r\n        0x0017 : \"GPSDestBearingRef\",\r\n        0x0018 : \"GPSDestBearing\",\r\n        0x0019 : \"GPSDestDistanceRef\",\r\n        0x001A : \"GPSDestDistance\",\r\n        0x001B : \"GPSProcessingMethod\",\r\n        0x001C : \"GPSAreaInformation\",\r\n        0x001D : \"GPSDateStamp\",\r\n        0x001E : \"GPSDifferential\"\r\n    };\r\n\r\n    var StringValues = EXIF.StringValues = {\r\n        ExposureProgram : {\r\n            0 : \"Not defined\",\r\n            1 : \"Manual\",\r\n            2 : \"Normal program\",\r\n            3 : \"Aperture priority\",\r\n            4 : \"Shutter priority\",\r\n            5 : \"Creative program\",\r\n            6 : \"Action program\",\r\n            7 : \"Portrait mode\",\r\n            8 : \"Landscape mode\"\r\n        },\r\n        MeteringMode : {\r\n            0 : \"Unknown\",\r\n            1 : \"Average\",\r\n            2 : \"CenterWeightedAverage\",\r\n            3 : \"Spot\",\r\n            4 : \"MultiSpot\",\r\n            5 : \"Pattern\",\r\n            6 : \"Partial\",\r\n            255 : \"Other\"\r\n        },\r\n        LightSource : {\r\n            0 : \"Unknown\",\r\n            1 : \"Daylight\",\r\n            2 : \"Fluorescent\",\r\n            3 : \"Tungsten (incandescent light)\",\r\n            4 : \"Flash\",\r\n            9 : \"Fine weather\",\r\n            10 : \"Cloudy weather\",\r\n            11 : \"Shade\",\r\n            12 : \"Daylight fluorescent (D 5700 - 7100K)\",\r\n            13 : \"Day white fluorescent (N 4600 - 5400K)\",\r\n            14 : \"Cool white fluorescent (W 3900 - 4500K)\",\r\n            15 : \"White fluorescent (WW 3200 - 3700K)\",\r\n            17 : \"Standard light A\",\r\n            18 : \"Standard light B\",\r\n            19 : \"Standard light C\",\r\n            20 : \"D55\",\r\n            21 : \"D65\",\r\n            22 : \"D75\",\r\n            23 : \"D50\",\r\n            24 : \"ISO studio tungsten\",\r\n            255 : \"Other\"\r\n        },\r\n        Flash : {\r\n            0x0000 : \"Flash did not fire\",\r\n            0x0001 : \"Flash fired\",\r\n            0x0005 : \"Strobe return light not detected\",\r\n            0x0007 : \"Strobe return light detected\",\r\n            0x0009 : \"Flash fired, compulsory flash mode\",\r\n            0x000D : \"Flash fired, compulsory flash mode, return light not detected\",\r\n            0x000F : \"Flash fired, compulsory flash mode, return light detected\",\r\n            0x0010 : \"Flash did not fire, compulsory flash mode\",\r\n            0x0018 : \"Flash did not fire, auto mode\",\r\n            0x0019 : \"Flash fired, auto mode\",\r\n            0x001D : \"Flash fired, auto mode, return light not detected\",\r\n            0x001F : \"Flash fired, auto mode, return light detected\",\r\n            0x0020 : \"No flash function\",\r\n            0x0041 : \"Flash fired, red-eye reduction mode\",\r\n            0x0045 : \"Flash fired, red-eye reduction mode, return light not detected\",\r\n            0x0047 : \"Flash fired, red-eye reduction mode, return light detected\",\r\n            0x0049 : \"Flash fired, compulsory flash mode, red-eye reduction mode\",\r\n            0x004D : \"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected\",\r\n            0x004F : \"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected\",\r\n            0x0059 : \"Flash fired, auto mode, red-eye reduction mode\",\r\n            0x005D : \"Flash fired, auto mode, return light not detected, red-eye reduction mode\",\r\n            0x005F : \"Flash fired, auto mode, return light detected, red-eye reduction mode\"\r\n        },\r\n        SensingMethod : {\r\n            1 : \"Not defined\",\r\n            2 : \"One-chip color area sensor\",\r\n            3 : \"Two-chip color area sensor\",\r\n            4 : \"Three-chip color area sensor\",\r\n            5 : \"Color sequential area sensor\",\r\n            7 : \"Trilinear sensor\",\r\n            8 : \"Color sequential linear sensor\"\r\n        },\r\n        SceneCaptureType : {\r\n            0 : \"Standard\",\r\n            1 : \"Landscape\",\r\n            2 : \"Portrait\",\r\n            3 : \"Night scene\"\r\n        },\r\n        SceneType : {\r\n            1 : \"Directly photographed\"\r\n        },\r\n        CustomRendered : {\r\n            0 : \"Normal process\",\r\n            1 : \"Custom process\"\r\n        },\r\n        WhiteBalance : {\r\n            0 : \"Auto white balance\",\r\n            1 : \"Manual white balance\"\r\n        },\r\n        GainControl : {\r\n            0 : \"None\",\r\n            1 : \"Low gain up\",\r\n            2 : \"High gain up\",\r\n            3 : \"Low gain down\",\r\n            4 : \"High gain down\"\r\n        },\r\n        Contrast : {\r\n            0 : \"Normal\",\r\n            1 : \"Soft\",\r\n            2 : \"Hard\"\r\n        },\r\n        Saturation : {\r\n            0 : \"Normal\",\r\n            1 : \"Low saturation\",\r\n            2 : \"High saturation\"\r\n        },\r\n        Sharpness : {\r\n            0 : \"Normal\",\r\n            1 : \"Soft\",\r\n            2 : \"Hard\"\r\n        },\r\n        SubjectDistanceRange : {\r\n            0 : \"Unknown\",\r\n            1 : \"Macro\",\r\n            2 : \"Close view\",\r\n            3 : \"Distant view\"\r\n        },\r\n        FileSource : {\r\n            3 : \"DSC\"\r\n        },\r\n\r\n        Components : {\r\n            0 : \"\",\r\n            1 : \"Y\",\r\n            2 : \"Cb\",\r\n            3 : \"Cr\",\r\n            4 : \"R\",\r\n            5 : \"G\",\r\n            6 : \"B\"\r\n        }\r\n    };\r\n\r\n    function addEvent(element, event, handler) {\r\n        if (element.addEventListener) {\r\n            element.addEventListener(event, handler, false);\r\n        } else if (element.attachEvent) {\r\n            element.attachEvent(\"on\" + event, handler);\r\n        }\r\n    }\r\n\r\n    function imageHasData(img) {\r\n        return !!(img.exifdata);\r\n    }\r\n\r\n\r\n    function base64ToArrayBuffer(base64, contentType) {\r\n        contentType = contentType || base64.match(/^data\\:([^\\;]+)\\;base64,/mi)[1] || ''; // e.g. 'data:image/jpeg;base64,...' => 'image/jpeg'\r\n        base64 = base64.replace(/^data\\:([^\\;]+)\\;base64,/gmi, '');\r\n        var binary = atob(base64);\r\n        var len = binary.length;\r\n        var buffer = new ArrayBuffer(len);\r\n        var view = new Uint8Array(buffer);\r\n        for (var i = 0; i < len; i++) {\r\n            view[i] = binary.charCodeAt(i);\r\n        }\r\n        return buffer;\r\n    }\r\n\r\n    function objectURLToBlob(url, callback) {\r\n        var http = new XMLHttpRequest();\r\n        http.open(\"GET\", url, true);\r\n        http.responseType = \"blob\";\r\n        http.onload = function(e) {\r\n            if (this.status == 200 || this.status === 0) {\r\n                callback(this.response);\r\n            }\r\n        };\r\n        http.send();\r\n    }\r\n\r\n    function getImageData(img, callback) {\r\n        function handleBinaryFile(binFile) {\r\n            var data = findEXIFinJPEG(binFile);\r\n            var iptcdata = findIPTCinJPEG(binFile);\r\n            img.exifdata = data || {};\r\n            img.iptcdata = iptcdata || {};\r\n            if (callback) {\r\n                callback.call(img);\r\n            }\r\n        }\r\n\r\n        if (img.src) {\r\n            if (/^data\\:/i.test(img.src)) { // Data URI\r\n                var arrayBuffer = base64ToArrayBuffer(img.src);\r\n                handleBinaryFile(arrayBuffer);\r\n\r\n            } else if (/^blob\\:/i.test(img.src)) { // Object URL\r\n                var fileReader = new FileReader();\r\n                fileReader.onload = function(e) {\r\n                    handleBinaryFile(e.target.result);\r\n                };\r\n                objectURLToBlob(img.src, function (blob) {\r\n                    fileReader.readAsArrayBuffer(blob);\r\n                });\r\n            } else {\r\n                var http = new XMLHttpRequest();\r\n                http.onload = function() {\r\n                    if (this.status == 200 || this.status === 0) {\r\n                        handleBinaryFile(http.response);\r\n                    } else {\r\n                        throw \"Could not load image\";\r\n                    }\r\n                    http = null;\r\n                };\r\n                http.open(\"GET\", img.src, true);\r\n                http.responseType = \"arraybuffer\";\r\n                http.send(null);\r\n            }\r\n        } else if (window.FileReader && (img instanceof window.Blob || img instanceof window.File)) {\r\n            var fileReader = new FileReader();\r\n            fileReader.onload = function(e) {\r\n                if (debug) console.log(\"Got file of length \" + e.target.result.byteLength);\r\n                handleBinaryFile(e.target.result);\r\n            };\r\n\r\n            fileReader.readAsArrayBuffer(img);\r\n        }\r\n    }\r\n\r\n    function findEXIFinJPEG(file) {\r\n        var dataView = new DataView(file);\r\n\r\n        if (debug) console.log(\"Got file of length \" + file.byteLength);\r\n        if ((dataView.getUint8(0) != 0xFF) || (dataView.getUint8(1) != 0xD8)) {\r\n            if (debug) console.log(\"Not a valid JPEG\");\r\n            return false; // not a valid jpeg\r\n        }\r\n\r\n        var offset = 2,\r\n            length = file.byteLength,\r\n            marker;\r\n\r\n        while (offset < length) {\r\n            if (dataView.getUint8(offset) != 0xFF) {\r\n                if (debug) console.log(\"Not a valid marker at offset \" + offset + \", found: \" + dataView.getUint8(offset));\r\n                return false; // not a valid marker, something is wrong\r\n            }\r\n\r\n            marker = dataView.getUint8(offset + 1);\r\n            if (debug) console.log(marker);\r\n\r\n            // we could implement handling for other markers here,\r\n            // but we're only looking for 0xFFE1 for EXIF data\r\n\r\n            if (marker == 225) {\r\n                if (debug) console.log(\"Found 0xFFE1 marker\");\r\n\r\n                return readEXIFData(dataView, offset + 4, dataView.getUint16(offset + 2) - 2);\r\n\r\n                // offset += 2 + file.getShortAt(offset+2, true);\r\n\r\n            } else {\r\n                offset += 2 + dataView.getUint16(offset+2);\r\n            }\r\n\r\n        }\r\n\r\n    }\r\n\r\n    function findIPTCinJPEG(file) {\r\n        var dataView = new DataView(file);\r\n\r\n        if (debug) console.log(\"Got file of length \" + file.byteLength);\r\n        if ((dataView.getUint8(0) != 0xFF) || (dataView.getUint8(1) != 0xD8)) {\r\n            if (debug) console.log(\"Not a valid JPEG\");\r\n            return false; // not a valid jpeg\r\n        }\r\n\r\n        var offset = 2,\r\n            length = file.byteLength;\r\n\r\n\r\n        var isFieldSegmentStart = function(dataView, offset){\r\n            return (\r\n                dataView.getUint8(offset) === 0x38 &&\r\n                dataView.getUint8(offset+1) === 0x42 &&\r\n                dataView.getUint8(offset+2) === 0x49 &&\r\n                dataView.getUint8(offset+3) === 0x4D &&\r\n                dataView.getUint8(offset+4) === 0x04 &&\r\n                dataView.getUint8(offset+5) === 0x04\r\n            );\r\n        };\r\n\r\n        while (offset < length) {\r\n\r\n            if ( isFieldSegmentStart(dataView, offset )){\r\n\r\n                // Get the length of the name header (which is padded to an even number of bytes)\r\n                var nameHeaderLength = dataView.getUint8(offset+7);\r\n                if(nameHeaderLength % 2 !== 0) nameHeaderLength += 1;\r\n                // Check for pre photoshop 6 format\r\n                if(nameHeaderLength === 0) {\r\n                    // Always 4\r\n                    nameHeaderLength = 4;\r\n                }\r\n\r\n                var startOffset = offset + 8 + nameHeaderLength;\r\n                var sectionLength = dataView.getUint16(offset + 6 + nameHeaderLength);\r\n\r\n                return readIPTCData(file, startOffset, sectionLength);\r\n\r\n                break;\r\n\r\n            }\r\n\r\n\r\n            // Not the marker, continue searching\r\n            offset++;\r\n\r\n        }\r\n\r\n    }\r\n    var IptcFieldMap = {\r\n        0x78 : 'caption',\r\n        0x6E : 'credit',\r\n        0x19 : 'keywords',\r\n        0x37 : 'dateCreated',\r\n        0x50 : 'byline',\r\n        0x55 : 'bylineTitle',\r\n        0x7A : 'captionWriter',\r\n        0x69 : 'headline',\r\n        0x74 : 'copyright',\r\n        0x0F : 'category'\r\n    };\r\n    function readIPTCData(file, startOffset, sectionLength){\r\n        var dataView = new DataView(file);\r\n        var data = {};\r\n        var fieldValue, fieldName, dataSize, segmentType, segmentSize;\r\n        var segmentStartPos = startOffset;\r\n        while(segmentStartPos < startOffset+sectionLength) {\r\n            if(dataView.getUint8(segmentStartPos) === 0x1C && dataView.getUint8(segmentStartPos+1) === 0x02){\r\n                segmentType = dataView.getUint8(segmentStartPos+2);\r\n                if(segmentType in IptcFieldMap) {\r\n                    dataSize = dataView.getInt16(segmentStartPos+3);\r\n                    segmentSize = dataSize + 5;\r\n                    fieldName = IptcFieldMap[segmentType];\r\n                    fieldValue = getStringFromDB(dataView, segmentStartPos+5, dataSize);\r\n                    // Check if we already stored a value with this name\r\n                    if(data.hasOwnProperty(fieldName)) {\r\n                        // Value already stored with this name, create multivalue field\r\n                        if(data[fieldName] instanceof Array) {\r\n                            data[fieldName].push(fieldValue);\r\n                        }\r\n                        else {\r\n                            data[fieldName] = [data[fieldName], fieldValue];\r\n                        }\r\n                    }\r\n                    else {\r\n                        data[fieldName] = fieldValue;\r\n                    }\r\n                }\r\n\r\n            }\r\n            segmentStartPos++;\r\n        }\r\n        return data;\r\n    }\r\n\r\n\r\n\r\n    function readTags(file, tiffStart, dirStart, strings, bigEnd) {\r\n        var entries = file.getUint16(dirStart, !bigEnd),\r\n            tags = {},\r\n            entryOffset, tag,\r\n            i;\r\n\r\n        for (i=0;i<entries;i++) {\r\n            entryOffset = dirStart + i*12 + 2;\r\n            tag = strings[file.getUint16(entryOffset, !bigEnd)];\r\n            if (!tag && debug) console.log(\"Unknown tag: \" + file.getUint16(entryOffset, !bigEnd));\r\n            tags[tag] = readTagValue(file, entryOffset, tiffStart, dirStart, bigEnd);\r\n        }\r\n        return tags;\r\n    }\r\n\r\n\r\n    function readTagValue(file, entryOffset, tiffStart, dirStart, bigEnd) {\r\n        var type = file.getUint16(entryOffset+2, !bigEnd),\r\n            numValues = file.getUint32(entryOffset+4, !bigEnd),\r\n            valueOffset = file.getUint32(entryOffset+8, !bigEnd) + tiffStart,\r\n            offset,\r\n            vals, val, n,\r\n            numerator, denominator;\r\n\r\n        switch (type) {\r\n            case 1: // byte, 8-bit unsigned int\r\n            case 7: // undefined, 8-bit byte, value depending on field\r\n                if (numValues == 1) {\r\n                    return file.getUint8(entryOffset + 8, !bigEnd);\r\n                } else {\r\n                    offset = numValues > 4 ? valueOffset : (entryOffset + 8);\r\n                    vals = [];\r\n                    for (n=0;n<numValues;n++) {\r\n                        vals[n] = file.getUint8(offset + n);\r\n                    }\r\n                    return vals;\r\n                }\r\n\r\n            case 2: // ascii, 8-bit byte\r\n                offset = numValues > 4 ? valueOffset : (entryOffset + 8);\r\n                return getStringFromDB(file, offset, numValues-1);\r\n\r\n            case 3: // short, 16 bit int\r\n                if (numValues == 1) {\r\n                    return file.getUint16(entryOffset + 8, !bigEnd);\r\n                } else {\r\n                    offset = numValues > 2 ? valueOffset : (entryOffset + 8);\r\n                    vals = [];\r\n                    for (n=0;n<numValues;n++) {\r\n                        vals[n] = file.getUint16(offset + 2*n, !bigEnd);\r\n                    }\r\n                    return vals;\r\n                }\r\n\r\n            case 4: // long, 32 bit int\r\n                if (numValues == 1) {\r\n                    return file.getUint32(entryOffset + 8, !bigEnd);\r\n                } else {\r\n                    vals = [];\r\n                    for (n=0;n<numValues;n++) {\r\n                        vals[n] = file.getUint32(valueOffset + 4*n, !bigEnd);\r\n                    }\r\n                    return vals;\r\n                }\r\n\r\n            case 5:    // rational = two long values, first is numerator, second is denominator\r\n                if (numValues == 1) {\r\n                    numerator = file.getUint32(valueOffset, !bigEnd);\r\n                    denominator = file.getUint32(valueOffset+4, !bigEnd);\r\n                    val = new Number(numerator / denominator);\r\n                    val.numerator = numerator;\r\n                    val.denominator = denominator;\r\n                    return val;\r\n                } else {\r\n                    vals = [];\r\n                    for (n=0;n<numValues;n++) {\r\n                        numerator = file.getUint32(valueOffset + 8*n, !bigEnd);\r\n                        denominator = file.getUint32(valueOffset+4 + 8*n, !bigEnd);\r\n                        vals[n] = new Number(numerator / denominator);\r\n                        vals[n].numerator = numerator;\r\n                        vals[n].denominator = denominator;\r\n                    }\r\n                    return vals;\r\n                }\r\n\r\n            case 9: // slong, 32 bit signed int\r\n                if (numValues == 1) {\r\n                    return file.getInt32(entryOffset + 8, !bigEnd);\r\n                } else {\r\n                    vals = [];\r\n                    for (n=0;n<numValues;n++) {\r\n                        vals[n] = file.getInt32(valueOffset + 4*n, !bigEnd);\r\n                    }\r\n                    return vals;\r\n                }\r\n\r\n            case 10: // signed rational, two slongs, first is numerator, second is denominator\r\n                if (numValues == 1) {\r\n                    return file.getInt32(valueOffset, !bigEnd) / file.getInt32(valueOffset+4, !bigEnd);\r\n                } else {\r\n                    vals = [];\r\n                    for (n=0;n<numValues;n++) {\r\n                        vals[n] = file.getInt32(valueOffset + 8*n, !bigEnd) / file.getInt32(valueOffset+4 + 8*n, !bigEnd);\r\n                    }\r\n                    return vals;\r\n                }\r\n        }\r\n    }\r\n\r\n    function getStringFromDB(buffer, start, length) {\r\n        var outstr = \"\"\r\n        for (var n = start; n < start+length; n++) {\r\n            outstr += String.fromCharCode(buffer.getUint8(n));\r\n        }\r\n        return outstr;\r\n    }\r\n\r\n    function readEXIFData(file, start) {\r\n        if (getStringFromDB(file, start, 4) != \"Exif\") {\r\n            if (debug) console.log(\"Not valid EXIF data! \" + getStringFromDB(file, start, 4));\r\n            return false;\r\n        }\r\n\r\n        var bigEnd,\r\n            tags, tag,\r\n            exifData, gpsData,\r\n            tiffOffset = start + 6;\r\n\r\n        // test for TIFF validity and endianness\r\n        if (file.getUint16(tiffOffset) == 0x4949) {\r\n            bigEnd = false;\r\n        } else if (file.getUint16(tiffOffset) == 0x4D4D) {\r\n            bigEnd = true;\r\n        } else {\r\n            if (debug) console.log(\"Not valid TIFF data! (no 0x4949 or 0x4D4D)\");\r\n            return false;\r\n        }\r\n\r\n        if (file.getUint16(tiffOffset+2, !bigEnd) != 0x002A) {\r\n            if (debug) console.log(\"Not valid TIFF data! (no 0x002A)\");\r\n            return false;\r\n        }\r\n\r\n        var firstIFDOffset = file.getUint32(tiffOffset+4, !bigEnd);\r\n\r\n        if (firstIFDOffset < 0x00000008) {\r\n            if (debug) console.log(\"Not valid TIFF data! (First offset less than 8)\", file.getUint32(tiffOffset+4, !bigEnd));\r\n            return false;\r\n        }\r\n\r\n        tags = readTags(file, tiffOffset, tiffOffset + firstIFDOffset, TiffTags, bigEnd);\r\n\r\n        if (tags.ExifIFDPointer) {\r\n            exifData = readTags(file, tiffOffset, tiffOffset + tags.ExifIFDPointer, ExifTags, bigEnd);\r\n            for (tag in exifData) {\r\n                switch (tag) {\r\n                    case \"LightSource\" :\r\n                    case \"Flash\" :\r\n                    case \"MeteringMode\" :\r\n                    case \"ExposureProgram\" :\r\n                    case \"SensingMethod\" :\r\n                    case \"SceneCaptureType\" :\r\n                    case \"SceneType\" :\r\n                    case \"CustomRendered\" :\r\n                    case \"WhiteBalance\" :\r\n                    case \"GainControl\" :\r\n                    case \"Contrast\" :\r\n                    case \"Saturation\" :\r\n                    case \"Sharpness\" :\r\n                    case \"SubjectDistanceRange\" :\r\n                    case \"FileSource\" :\r\n                        exifData[tag] = StringValues[tag][exifData[tag]];\r\n                        break;\r\n\r\n                    case \"ExifVersion\" :\r\n                    case \"FlashpixVersion\" :\r\n                        exifData[tag] = String.fromCharCode(exifData[tag][0], exifData[tag][1], exifData[tag][2], exifData[tag][3]);\r\n                        break;\r\n\r\n                    case \"ComponentsConfiguration\" :\r\n                        exifData[tag] =\r\n                            StringValues.Components[exifData[tag][0]] +\r\n                            StringValues.Components[exifData[tag][1]] +\r\n                            StringValues.Components[exifData[tag][2]] +\r\n                            StringValues.Components[exifData[tag][3]];\r\n                        break;\r\n                }\r\n                tags[tag] = exifData[tag];\r\n            }\r\n        }\r\n\r\n        if (tags.GPSInfoIFDPointer) {\r\n            gpsData = readTags(file, tiffOffset, tiffOffset + tags.GPSInfoIFDPointer, GPSTags, bigEnd);\r\n            for (tag in gpsData) {\r\n                switch (tag) {\r\n                    case \"GPSVersionID\" :\r\n                        gpsData[tag] = gpsData[tag][0] +\r\n                            \".\" + gpsData[tag][1] +\r\n                            \".\" + gpsData[tag][2] +\r\n                            \".\" + gpsData[tag][3];\r\n                        break;\r\n                }\r\n                tags[tag] = gpsData[tag];\r\n            }\r\n        }\r\n\r\n        return tags;\r\n    }\r\n\r\n    EXIF.getData = function(img, callback) {\r\n        if ((img instanceof Image || img instanceof HTMLImageElement) && !img.complete) return false;\r\n\r\n        if (!imageHasData(img)) {\r\n            getImageData(img, callback);\r\n        } else {\r\n            if (callback) {\r\n                callback.call(img);\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n\r\n    EXIF.getTag = function(img, tag) {\r\n        if (!imageHasData(img)) return;\r\n        return img.exifdata[tag];\r\n    }\r\n    \r\n    EXIF.getIptcTag = function(img, tag) {\r\n        if (!imageHasData(img)) return;\r\n        return img.iptcdata[tag];\r\n    }\r\n\r\n    EXIF.getAllTags = function(img) {\r\n        if (!imageHasData(img)) return {};\r\n        var a,\r\n            data = img.exifdata,\r\n            tags = {};\r\n        for (a in data) {\r\n            if (data.hasOwnProperty(a)) {\r\n                tags[a] = data[a];\r\n            }\r\n        }\r\n        return tags;\r\n    }\r\n    \r\n    EXIF.getAllIptcTags = function(img) {\r\n        if (!imageHasData(img)) return {};\r\n        var a,\r\n            data = img.iptcdata,\r\n            tags = {};\r\n        for (a in data) {\r\n            if (data.hasOwnProperty(a)) {\r\n                tags[a] = data[a];\r\n            }\r\n        }\r\n        return tags;\r\n    }\r\n\r\n    EXIF.pretty = function(img) {\r\n        if (!imageHasData(img)) return \"\";\r\n        var a,\r\n            data = img.exifdata,\r\n            strPretty = \"\";\r\n        for (a in data) {\r\n            if (data.hasOwnProperty(a)) {\r\n                if (typeof data[a] == \"object\") {\r\n                    if (data[a] instanceof Number) {\r\n                        strPretty += a + \" : \" + data[a] + \" [\" + data[a].numerator + \"/\" + data[a].denominator + \"]\\r\\n\";\r\n                    } else {\r\n                        strPretty += a + \" : [\" + data[a].length + \" values]\\r\\n\";\r\n                    }\r\n                } else {\r\n                    strPretty += a + \" : \" + data[a] + \"\\r\\n\";\r\n                }\r\n            }\r\n        }\r\n        return strPretty;\r\n    }\r\n\r\n    EXIF.readFromBinaryFile = function(file) {\r\n        return findEXIFinJPEG(file);\r\n    }\r\n\r\n    if (typeof define === 'function' && define.amd) {\r\n        define('exif-js', [], function() {\r\n            return EXIF;\r\n        });\r\n    }\r\n}.call(this));\r\n\r\n","'use strict';\r\n\r\n/**\r\n * @preserve FastClick: polyfill to remove click delays on browsers with touch UIs.\r\n *\r\n * @codingstandard ftlabs-jsv2\r\n * @copyright The Financial Times Limited [All Rights Reserved]\r\n * @license MIT License (see LICENSE.txt)\r\n */\r\n\r\n/*jslint browser:true, node:true*/\r\n/*global define, Event, Node*/\r\n\r\n\r\n/**\r\n * Instantiate fast-clicking listeners on the specified layer.\r\n *\r\n * @constructor\r\n * @param {Element} layer The layer to listen on\r\n * @param {Object} [options={}] The options to override the defaults\r\n */\r\nfunction FastClick(layer, options) {\r\n\tvar oldOnClick;\r\n\r\n\toptions = options || {};\r\n\r\n\t/**\r\n\t * Whether a click is currently being tracked.\r\n\t *\r\n\t * @type boolean\r\n\t */\r\n\tthis.trackingClick = false;\r\n\r\n\r\n\t/**\r\n\t * Timestamp for when click tracking started.\r\n\t *\r\n\t * @type number\r\n\t */\r\n\tthis.trackingClickStart = 0;\r\n\r\n\r\n\t/**\r\n\t * The element being tracked for a click.\r\n\t *\r\n\t * @type EventTarget\r\n\t */\r\n\tthis.targetElement = null;\r\n\r\n\r\n\t/**\r\n\t * X-coordinate of touch start event.\r\n\t *\r\n\t * @type number\r\n\t */\r\n\tthis.touchStartX = 0;\r\n\r\n\r\n\t/**\r\n\t * Y-coordinate of touch start event.\r\n\t *\r\n\t * @type number\r\n\t */\r\n\tthis.touchStartY = 0;\r\n\r\n\r\n\t/**\r\n\t * ID of the last touch, retrieved from Touch.identifier.\r\n\t *\r\n\t * @type number\r\n\t */\r\n\tthis.lastTouchIdentifier = 0;\r\n\r\n\r\n\t/**\r\n\t * Touchmove boundary, beyond which a click will be cancelled.\r\n\t *\r\n\t * @type number\r\n\t */\r\n\tthis.touchBoundary = options.touchBoundary || 10;\r\n\r\n\r\n\t/**\r\n\t * The FastClick layer.\r\n\t *\r\n\t * @type Element\r\n\t */\r\n\tthis.layer = layer;\r\n\r\n\t/**\r\n\t * The minimum time between tap(touchstart and touchend) events\r\n\t *\r\n\t * @type number\r\n\t */\r\n\tthis.tapDelay = options.tapDelay || 200;\r\n\r\n\t/**\r\n\t * The maximum time for a tap\r\n\t *\r\n\t * @type number\r\n\t */\r\n\tthis.tapTimeout = options.tapTimeout || 700;\r\n\r\n\tif (FastClick.notNeeded(layer)) {\r\n\t\treturn;\r\n\t}\r\n\r\n\t// Some old versions of Android don't have Function.prototype.bind\r\n\tfunction bind(method, context) {\r\n\t\treturn function() { return method.apply(context, arguments); };\r\n\t}\r\n\r\n\r\n\tvar methods = ['onMouse', 'onClick', 'onTouchStart', 'onTouchMove', 'onTouchEnd', 'onTouchCancel'];\r\n\tvar context = this;\r\n\tfor (var i = 0, l = methods.length; i < l; i++) {\r\n\t\tcontext[methods[i]] = bind(context[methods[i]], context);\r\n\t}\r\n\r\n\t// Set up event handlers as required\r\n\tif (deviceIsAndroid) {\r\n\t\tlayer.addEventListener('mouseover', this.onMouse, true);\r\n\t\tlayer.addEventListener('mousedown', this.onMouse, true);\r\n\t\tlayer.addEventListener('mouseup', this.onMouse, true);\r\n\t}\r\n\r\n\tlayer.addEventListener('click', this.onClick, true);\r\n\tlayer.addEventListener('touchstart', this.onTouchStart, false);\r\n\tlayer.addEventListener('touchmove', this.onTouchMove, false);\r\n\tlayer.addEventListener('touchend', this.onTouchEnd, false);\r\n\tlayer.addEventListener('touchcancel', this.onTouchCancel, false);\r\n\r\n\t// Hack is required for browsers that don't support Event#stopImmediatePropagation (e.g. Android 2)\r\n\t// which is how FastClick normally stops click events bubbling to callbacks registered on the FastClick\r\n\t// layer when they are cancelled.\r\n\tif (!Event.prototype.stopImmediatePropagation) {\r\n\t\tlayer.removeEventListener = function(type, callback, capture) {\r\n\t\t\tvar rmv = Node.prototype.removeEventListener;\r\n\t\t\tif (type === 'click') {\r\n\t\t\t\trmv.call(layer, type, callback.hijacked || callback, capture);\r\n\t\t\t} else {\r\n\t\t\t\trmv.call(layer, type, callback, capture);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tlayer.addEventListener = function(type, callback, capture) {\r\n\t\t\tvar adv = Node.prototype.addEventListener;\r\n\t\t\tif (type === 'click') {\r\n\t\t\t\tadv.call(layer, type, callback.hijacked || (callback.hijacked = function(event) {\r\n\t\t\t\t\tif (!event.propagationStopped) {\r\n\t\t\t\t\t\tcallback(event);\r\n\t\t\t\t\t}\r\n\t\t\t\t}), capture);\r\n\t\t\t} else {\r\n\t\t\t\tadv.call(layer, type, callback, capture);\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n\r\n\t// If a handler is already declared in the element's onclick attribute, it will be fired before\r\n\t// FastClick's onClick handler. Fix this by pulling out the user-defined handler function and\r\n\t// adding it as listener.\r\n\tif (typeof layer.onclick === 'function') {\r\n\r\n\t\t// Android browser on at least 3.2 requires a new reference to the function in layer.onclick\r\n\t\t// - the old one won't work if passed to addEventListener directly.\r\n\t\toldOnClick = layer.onclick;\r\n\t\tlayer.addEventListener('click', function(event) {\r\n\t\t\toldOnClick(event);\r\n\t\t}, false);\r\n\t\tlayer.onclick = null;\r\n\t}\r\n}\r\n\r\n/**\r\n* Windows Phone 8.1 fakes user agent string to look like Android and iPhone.\r\n*\r\n* @type boolean\r\n*/\r\nvar deviceIsWindowsPhone = navigator.userAgent.indexOf(\"Windows Phone\") >= 0;\r\n\r\n/**\r\n * Android requires exceptions.\r\n *\r\n * @type boolean\r\n */\r\nvar deviceIsAndroid = navigator.userAgent.indexOf('Android') > 0 && !deviceIsWindowsPhone;\r\n\r\n\r\n/**\r\n * iOS requires exceptions.\r\n *\r\n * @type boolean\r\n */\r\nvar deviceIsIOS = /iP(ad|hone|od)/.test(navigator.userAgent) && !deviceIsWindowsPhone;\r\n\r\n\r\n/**\r\n * iOS 4 requires an exception for select elements.\r\n *\r\n * @type boolean\r\n */\r\nvar deviceIsIOS4 = deviceIsIOS && (/OS 4_\\d(_\\d)?/).test(navigator.userAgent);\r\n\r\n\r\n/**\r\n * iOS 6.0-7.* requires the target element to be manually derived\r\n *\r\n * @type boolean\r\n */\r\nvar deviceIsIOSWithBadTarget = deviceIsIOS && (/OS [6-7]_\\d/).test(navigator.userAgent);\r\n\r\n/**\r\n * BlackBerry requires exceptions.\r\n *\r\n * @type boolean\r\n */\r\nvar deviceIsBlackBerry10 = navigator.userAgent.indexOf('BB10') > 0;\r\n\r\n/**\r\n * Determine whether a given element requires a native click.\r\n *\r\n * @param {EventTarget|Element} target Target DOM element\r\n * @returns {boolean} Returns true if the element needs a native click\r\n */\r\nFastClick.prototype.needsClick = function(target) {\r\n\tswitch (target.nodeName.toLowerCase()) {\r\n\r\n\t// Don't send a synthetic click to disabled inputs (issue #62)\r\n\tcase 'button':\r\n\tcase 'select':\r\n\tcase 'textarea':\r\n\t\tif (target.disabled) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\tbreak;\r\n\tcase 'input':\r\n\r\n\t\t// File inputs need real clicks on iOS 6 due to a browser bug (issue #68)\r\n\t\tif ((deviceIsIOS && target.type === 'file') || target.disabled) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\tbreak;\r\n\tcase 'label':\r\n\tcase 'iframe': // iOS8 homescreen apps can prevent events bubbling into frames\r\n\tcase 'video':\r\n\t\treturn true;\r\n\t}\r\n\r\n\treturn (/\\bneedsclick\\b/).test(target.className);\r\n};\r\n\r\n\r\n/**\r\n * Determine whether a given element requires a call to focus to simulate click into element.\r\n *\r\n * @param {EventTarget|Element} target Target DOM element\r\n * @returns {boolean} Returns true if the element requires a call to focus to simulate native click.\r\n */\r\nFastClick.prototype.needsFocus = function(target) {\r\n\tswitch (target.nodeName.toLowerCase()) {\r\n\tcase 'textarea':\r\n\t\treturn true;\r\n\tcase 'select':\r\n\t\treturn !deviceIsAndroid;\r\n\tcase 'input':\r\n\t\tswitch (target.type) {\r\n\t\tcase 'button':\r\n\t\tcase 'checkbox':\r\n\t\tcase 'file':\r\n\t\tcase 'image':\r\n\t\tcase 'radio':\r\n\t\tcase 'submit':\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\t// No point in attempting to focus disabled inputs\r\n\t\treturn !target.disabled && !target.readOnly;\r\n\tdefault:\r\n\t\treturn (/\\bneedsfocus\\b/).test(target.className);\r\n\t}\r\n};\r\n\r\n\r\n/**\r\n * Send a click event to the specified element.\r\n *\r\n * @param {EventTarget|Element} targetElement\r\n * @param {Event} event\r\n */\r\nFastClick.prototype.sendClick = function(targetElement, event) {\r\n\tvar clickEvent, touch;\r\n\r\n\t// On some Android devices activeElement needs to be blurred otherwise the synthetic click will have no effect (#24)\r\n\tif (document.activeElement && document.activeElement !== targetElement) {\r\n\t\tdocument.activeElement.blur();\r\n\t}\r\n\r\n\ttouch = event.changedTouches[0];\r\n\r\n\t// Synthesise a click event, with an extra attribute so it can be tracked\r\n\tclickEvent = document.createEvent('MouseEvents');\r\n\tclickEvent.initMouseEvent(this.determineEventType(targetElement), true, true, window, 1, touch.screenX, touch.screenY, touch.clientX, touch.clientY, false, false, false, false, 0, null);\r\n\tclickEvent.forwardedTouchEvent = true;\r\n\ttargetElement.dispatchEvent(clickEvent);\r\n};\r\n\r\nFastClick.prototype.determineEventType = function(targetElement) {\r\n\r\n\t//Issue #159: Android Chrome Select Box does not open with a synthetic click event\r\n\tif (deviceIsAndroid && targetElement.tagName.toLowerCase() === 'select') {\r\n\t\treturn 'mousedown';\r\n\t}\r\n\r\n\treturn 'click';\r\n};\r\n\r\n\r\n/**\r\n * @param {EventTarget|Element} targetElement\r\n */\r\nFastClick.prototype.focus = function(targetElement) {\r\n\tvar length;\r\n\r\n\t// Issue #160: on iOS 7, some input elements (e.g. date datetime month) throw a vague TypeError on setSelectionRange. These elements don't have an integer value for the selectionStart and selectionEnd properties, but unfortunately that can't be used for detection because accessing the properties also throws a TypeError. Just check the type instead. Filed as Apple bug #15122724.\r\n\tif (deviceIsIOS && targetElement.setSelectionRange && targetElement.type.indexOf('date') !== 0 && targetElement.type !== 'time' && targetElement.type !== 'month') {\r\n\t\tlength = targetElement.value.length;\r\n\t\ttargetElement.setSelectionRange(length, length);\r\n\t} else {\r\n\t\ttargetElement.focus();\r\n\t}\r\n};\r\n\r\n\r\n/**\r\n * Check whether the given target element is a child of a scrollable layer and if so, set a flag on it.\r\n *\r\n * @param {EventTarget|Element} targetElement\r\n */\r\nFastClick.prototype.updateScrollParent = function(targetElement) {\r\n\tvar scrollParent, parentElement;\r\n\r\n\tscrollParent = targetElement.fastClickScrollParent;\r\n\r\n\t// Attempt to discover whether the target element is contained within a scrollable layer. Re-check if the\r\n\t// target element was moved to another parent.\r\n\tif (!scrollParent || !scrollParent.contains(targetElement)) {\r\n\t\tparentElement = targetElement;\r\n\t\tdo {\r\n\t\t\tif (parentElement.scrollHeight > parentElement.offsetHeight) {\r\n\t\t\t\tscrollParent = parentElement;\r\n\t\t\t\ttargetElement.fastClickScrollParent = parentElement;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tparentElement = parentElement.parentElement;\r\n\t\t} while (parentElement);\r\n\t}\r\n\r\n\t// Always update the scroll top tracker if possible.\r\n\tif (scrollParent) {\r\n\t\tscrollParent.fastClickLastScrollTop = scrollParent.scrollTop;\r\n\t}\r\n};\r\n\r\n\r\n/**\r\n * @param {EventTarget} targetElement\r\n * @returns {Element|EventTarget}\r\n */\r\nFastClick.prototype.getTargetElementFromEventTarget = function(eventTarget) {\r\n\r\n\t// On some older browsers (notably Safari on iOS 4.1 - see issue #56) the event target may be a text node.\r\n\tif (eventTarget.nodeType === Node.TEXT_NODE) {\r\n\t\treturn eventTarget.parentNode;\r\n\t}\r\n\r\n\treturn eventTarget;\r\n};\r\n\r\n\r\n/**\r\n * On touch start, record the position and scroll offset.\r\n *\r\n * @param {Event} event\r\n * @returns {boolean}\r\n */\r\nFastClick.prototype.onTouchStart = function(event) {\r\n\tvar targetElement, touch, selection;\r\n\r\n\t// Ignore multiple touches, otherwise pinch-to-zoom is prevented if both fingers are on the FastClick element (issue #111).\r\n\tif (event.targetTouches.length > 1) {\r\n\t\treturn true;\r\n\t}\r\n\r\n\ttargetElement = this.getTargetElementFromEventTarget(event.target);\r\n\ttouch = event.targetTouches[0];\r\n\t\r\n\tif (deviceIsIOS) {\r\n\r\n\t\t// Only trusted events will deselect text on iOS (issue #49)\r\n\t\tselection = window.getSelection();\r\n\t\tif (selection.rangeCount && !selection.isCollapsed) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\tif (!deviceIsIOS4) {\r\n\r\n\t\t\t// Weird things happen on iOS when an alert or confirm dialog is opened from a click event callback (issue #23):\r\n\t\t\t// when the user next taps anywhere else on the page, new touchstart and touchend events are dispatched\r\n\t\t\t// with the same identifier as the touch event that previously triggered the click that triggered the alert.\r\n\t\t\t// Sadly, there is an issue on iOS 4 that causes some normal touch events to have the same identifier as an\r\n\t\t\t// immediately preceeding touch event (issue #52), so this fix is unavailable on that platform.\r\n\t\t\t// Issue 120: touch.identifier is 0 when Chrome dev tools 'Emulate touch events' is set with an iOS device UA string,\r\n\t\t\t// which causes all touch events to be ignored. As this block only applies to iOS, and iOS identifiers are always long,\r\n\t\t\t// random integers, it's safe to to continue if the identifier is 0 here.\r\n\t\t\tif (touch.identifier && touch.identifier === this.lastTouchIdentifier) {\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\tthis.lastTouchIdentifier = touch.identifier;\r\n\r\n\t\t\t// If the target element is a child of a scrollable layer (using -webkit-overflow-scrolling: touch) and:\r\n\t\t\t// 1) the user does a fling scroll on the scrollable layer\r\n\t\t\t// 2) the user stops the fling scroll with another tap\r\n\t\t\t// then the event.target of the last 'touchend' event will be the element that was under the user's finger\r\n\t\t\t// when the fling scroll was started, causing FastClick to send a click event to that layer - unless a check\r\n\t\t\t// is made to ensure that a parent layer was not scrolled before sending a synthetic click (issue #42).\r\n\t\t\tthis.updateScrollParent(targetElement);\r\n\t\t}\r\n\t}\r\n\r\n\tthis.trackingClick = true;\r\n\tthis.trackingClickStart = event.timeStamp;\r\n\tthis.targetElement = targetElement;\r\n\r\n\tthis.touchStartX = touch.pageX;\r\n\tthis.touchStartY = touch.pageY;\r\n\r\n\t// Prevent phantom clicks on fast double-tap (issue #36)\r\n\tif ((event.timeStamp - this.lastClickTime) < this.tapDelay) {\r\n\t\tevent.preventDefault();\r\n\t}\r\n\r\n\treturn true;\r\n};\r\n\r\n\r\n/**\r\n * Based on a touchmove event object, check whether the touch has moved past a boundary since it started.\r\n *\r\n * @param {Event} event\r\n * @returns {boolean}\r\n */\r\nFastClick.prototype.touchHasMoved = function(event) {\r\n\tvar touch = event.changedTouches[0], boundary = this.touchBoundary;\r\n\r\n\tif (Math.abs(touch.pageX - this.touchStartX) > boundary || Math.abs(touch.pageY - this.touchStartY) > boundary) {\r\n\t\treturn true;\r\n\t}\r\n\r\n\treturn false;\r\n};\r\n\r\n\r\n/**\r\n * Update the last position.\r\n *\r\n * @param {Event} event\r\n * @returns {boolean}\r\n */\r\nFastClick.prototype.onTouchMove = function(event) {\r\n\tif (!this.trackingClick) {\r\n\t\treturn true;\r\n\t}\r\n\r\n\t// If the touch has moved, cancel the click tracking\r\n\tif (this.targetElement !== this.getTargetElementFromEventTarget(event.target) || this.touchHasMoved(event)) {\r\n\t\tthis.trackingClick = false;\r\n\t\tthis.targetElement = null;\r\n\t}\r\n\r\n\treturn true;\r\n};\r\n\r\n\r\n/**\r\n * Attempt to find the labelled control for the given label element.\r\n *\r\n * @param {EventTarget|HTMLLabelElement} labelElement\r\n * @returns {Element|null}\r\n */\r\nFastClick.prototype.findControl = function(labelElement) {\r\n\r\n\t// Fast path for newer browsers supporting the HTML5 control attribute\r\n\tif (labelElement.control !== undefined) {\r\n\t\treturn labelElement.control;\r\n\t}\r\n\r\n\t// All browsers under test that support touch events also support the HTML5 htmlFor attribute\r\n\tif (labelElement.htmlFor) {\r\n\t\treturn document.getElementById(labelElement.htmlFor);\r\n\t}\r\n\r\n\t// If no for attribute exists, attempt to retrieve the first labellable descendant element\r\n\t// the list of which is defined here: http://www.w3.org/TR/html5/forms.html#category-label\r\n\treturn labelElement.querySelector('button, input:not([type=hidden]), keygen, meter, output, progress, select, textarea');\r\n};\r\n\r\n\r\n/**\r\n * On touch end, determine whether to send a click event at once.\r\n *\r\n * @param {Event} event\r\n * @returns {boolean}\r\n */\r\nFastClick.prototype.onTouchEnd = function(event) {\r\n\tvar forElement, trackingClickStart, targetTagName, scrollParent, touch, targetElement = this.targetElement;\r\n\r\n\tif (!this.trackingClick) {\r\n\t\treturn true;\r\n\t}\r\n\r\n\t// Prevent phantom clicks on fast double-tap (issue #36)\r\n\tif ((event.timeStamp - this.lastClickTime) < this.tapDelay) {\r\n\t\tthis.cancelNextClick = true;\r\n\t\treturn true;\r\n\t}\r\n\r\n\tif ((event.timeStamp - this.trackingClickStart) > this.tapTimeout) {\r\n\t\treturn true;\r\n\t}\r\n\r\n\t// Reset to prevent wrong click cancel on input (issue #156).\r\n\tthis.cancelNextClick = false;\r\n\r\n\tthis.lastClickTime = event.timeStamp;\r\n\r\n\ttrackingClickStart = this.trackingClickStart;\r\n\tthis.trackingClick = false;\r\n\tthis.trackingClickStart = 0;\r\n\r\n\t// On some iOS devices, the targetElement supplied with the event is invalid if the layer\r\n\t// is performing a transition or scroll, and has to be re-detected manually. Note that\r\n\t// for this to function correctly, it must be called *after* the event target is checked!\r\n\t// See issue #57; also filed as rdar://13048589 .\r\n\tif (deviceIsIOSWithBadTarget) {\r\n\t\ttouch = event.changedTouches[0];\r\n\r\n\t\t// In certain cases arguments of elementFromPoint can be negative, so prevent setting targetElement to null\r\n\t\ttargetElement = document.elementFromPoint(touch.pageX - window.pageXOffset, touch.pageY - window.pageYOffset) || targetElement;\r\n\t\ttargetElement.fastClickScrollParent = this.targetElement.fastClickScrollParent;\r\n\t}\r\n\r\n\ttargetTagName = targetElement.tagName.toLowerCase();\r\n\tif (targetTagName === 'label') {\r\n\t\tforElement = this.findControl(targetElement);\r\n\t\tif (forElement) {\r\n\t\t\tthis.focus(targetElement);\r\n\t\t\tif (deviceIsAndroid) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\ttargetElement = forElement;\r\n\t\t}\r\n\t} else if (this.needsFocus(targetElement)) {\r\n\r\n\t\t// Case 1: If the touch started a while ago (best guess is 100ms based on tests for issue #36) then focus will be triggered anyway. Return early and unset the target element reference so that the subsequent click will be allowed through.\r\n\t\t// Case 2: Without this exception for input elements tapped when the document is contained in an iframe, then any inputted text won't be visible even though the value attribute is updated as the user types (issue #37).\r\n\t\tif ((event.timeStamp - trackingClickStart) > 100 || (deviceIsIOS && window.top !== window && targetTagName === 'input')) {\r\n\t\t\tthis.targetElement = null;\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tthis.focus(targetElement);\r\n\t\tthis.sendClick(targetElement, event);\r\n\r\n\t\t// Select elements need the event to go through on iOS 4, otherwise the selector menu won't open.\r\n\t\t// Also this breaks opening selects when VoiceOver is active on iOS6, iOS7 (and possibly others)\r\n\t\tif (!deviceIsIOS || targetTagName !== 'select') {\r\n\t\t\tthis.targetElement = null;\r\n\t\t\tevent.preventDefault();\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\t}\r\n\r\n\tif (deviceIsIOS && !deviceIsIOS4) {\r\n\r\n\t\t// Don't send a synthetic click event if the target element is contained within a parent layer that was scrolled\r\n\t\t// and this tap is being used to stop the scrolling (usually initiated by a fling - issue #42).\r\n\t\tscrollParent = targetElement.fastClickScrollParent;\r\n\t\tif (scrollParent && scrollParent.fastClickLastScrollTop !== scrollParent.scrollTop) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t}\r\n\r\n\t// Prevent the actual click from going though - unless the target node is marked as requiring\r\n\t// real clicks or if it is in the whitelist in which case only non-programmatic clicks are permitted.\r\n\tif (!this.needsClick(targetElement)) {\r\n\t\tevent.preventDefault();\r\n\t\tthis.sendClick(targetElement, event);\r\n\t}\r\n\r\n\treturn false;\r\n};\r\n\r\n\r\n/**\r\n * On touch cancel, stop tracking the click.\r\n *\r\n * @returns {void}\r\n */\r\nFastClick.prototype.onTouchCancel = function() {\r\n\tthis.trackingClick = false;\r\n\tthis.targetElement = null;\r\n};\r\n\r\n\r\n/**\r\n * Determine mouse events which should be permitted.\r\n *\r\n * @param {Event} event\r\n * @returns {boolean}\r\n */\r\nFastClick.prototype.onMouse = function(event) {\r\n\r\n\t// If a target element was never set (because a touch event was never fired) allow the event\r\n\tif (!this.targetElement) {\r\n\t\treturn true;\r\n\t}\r\n\r\n\tif (event.forwardedTouchEvent) {\r\n\t\treturn true;\r\n\t}\r\n\r\n\t// Programmatically generated events targeting a specific element should be permitted\r\n\tif (!event.cancelable) {\r\n\t\treturn true;\r\n\t}\r\n\r\n\t// Derive and check the target element to see whether the mouse event needs to be permitted;\r\n\t// unless explicitly enabled, prevent non-touch click events from triggering actions,\r\n\t// to prevent ghost/doubleclicks.\r\n\tif (!this.needsClick(this.targetElement) || this.cancelNextClick) {\r\n\r\n\t\t// Prevent any user-added listeners declared on FastClick element from being fired.\r\n\t\tif (event.stopImmediatePropagation) {\r\n\t\t\tevent.stopImmediatePropagation();\r\n\t\t} else {\r\n\r\n\t\t\t// Part of the hack for browsers that don't support Event#stopImmediatePropagation (e.g. Android 2)\r\n\t\t\tevent.propagationStopped = true;\r\n\t\t}\r\n\r\n\t\t// Cancel the event\r\n\t\tevent.stopPropagation();\r\n\t\tevent.preventDefault();\r\n\r\n\t\treturn false;\r\n\t}\r\n\r\n\t// If the mouse event is permitted, return true for the action to go through.\r\n\treturn true;\r\n};\r\n\r\n\r\n/**\r\n * On actual clicks, determine whether this is a touch-generated click, a click action occurring\r\n * naturally after a delay after a touch (which needs to be cancelled to avoid duplication), or\r\n * an actual click which should be permitted.\r\n *\r\n * @param {Event} event\r\n * @returns {boolean}\r\n */\r\nFastClick.prototype.onClick = function(event) {\r\n\tvar permitted;\r\n\r\n\t// It's possible for another FastClick-like library delivered with third-party code to fire a click event before FastClick does (issue #44). In that case, set the click-tracking flag back to false and return early. This will cause onTouchEnd to return early.\r\n\tif (this.trackingClick) {\r\n\t\tthis.targetElement = null;\r\n\t\tthis.trackingClick = false;\r\n\t\treturn true;\r\n\t}\r\n\r\n\t// Very odd behaviour on iOS (issue #18): if a submit element is present inside a form and the user hits enter in the iOS simulator or clicks the Go button on the pop-up OS keyboard the a kind of 'fake' click event will be triggered with the submit-type input element as the target.\r\n\tif (event.target.type === 'submit' && event.detail === 0) {\r\n\t\treturn true;\r\n\t}\r\n\r\n\tpermitted = this.onMouse(event);\r\n\r\n\t// Only unset targetElement if the click is not permitted. This will ensure that the check for !targetElement in onMouse fails and the browser's click doesn't go through.\r\n\tif (!permitted) {\r\n\t\tthis.targetElement = null;\r\n\t}\r\n\r\n\t// If clicks are permitted, return true for the action to go through.\r\n\treturn permitted;\r\n};\r\n\r\n\r\n/**\r\n * Remove all FastClick's event listeners.\r\n *\r\n * @returns {void}\r\n */\r\nFastClick.prototype.destroy = function() {\r\n\tvar layer = this.layer;\r\n\r\n\tif (deviceIsAndroid) {\r\n\t\tlayer.removeEventListener('mouseover', this.onMouse, true);\r\n\t\tlayer.removeEventListener('mousedown', this.onMouse, true);\r\n\t\tlayer.removeEventListener('mouseup', this.onMouse, true);\r\n\t}\r\n\r\n\tlayer.removeEventListener('click', this.onClick, true);\r\n\tlayer.removeEventListener('touchstart', this.onTouchStart, false);\r\n\tlayer.removeEventListener('touchmove', this.onTouchMove, false);\r\n\tlayer.removeEventListener('touchend', this.onTouchEnd, false);\r\n\tlayer.removeEventListener('touchcancel', this.onTouchCancel, false);\r\n};\r\n\r\n\r\n/**\r\n * Check whether FastClick is needed.\r\n *\r\n * @param {Element} layer The layer to listen on\r\n */\r\nFastClick.notNeeded = function(layer) {\r\n\tvar metaViewport;\r\n\tvar chromeVersion;\r\n\tvar blackberryVersion;\r\n\tvar firefoxVersion;\r\n\r\n\t// Devices that don't support touch don't need FastClick\r\n\tif (typeof window.ontouchstart === 'undefined') {\r\n\t\treturn true;\r\n\t}\r\n\r\n\t// Chrome version - zero for other browsers\r\n\tchromeVersion = +(/Chrome\\/([0-9]+)/.exec(navigator.userAgent) || [,0])[1];\r\n\r\n\tif (chromeVersion) {\r\n\r\n\t\tif (deviceIsAndroid) {\r\n\t\t\tmetaViewport = document.querySelector('meta[name=viewport]');\r\n\r\n\t\t\tif (metaViewport) {\r\n\t\t\t\t// Chrome on Android with user-scalable=\"no\" doesn't need FastClick (issue #89)\r\n\t\t\t\tif (metaViewport.content.indexOf('user-scalable=no') !== -1) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t\t// Chrome 32 and above with width=device-width or less don't need FastClick\r\n\t\t\t\tif (chromeVersion > 31 && document.documentElement.scrollWidth <= window.outerWidth) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t// Chrome desktop doesn't need FastClick (issue #15)\r\n\t\t} else {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t}\r\n\r\n\tif (deviceIsBlackBerry10) {\r\n\t\tblackberryVersion = navigator.userAgent.match(/Version\\/([0-9]*)\\.([0-9]*)/);\r\n\r\n\t\t// BlackBerry 10.3+ does not require Fastclick library.\r\n\t\t// https://github.com/ftlabs/fastclick/issues/251\r\n\t\tif (blackberryVersion[1] >= 10 && blackberryVersion[2] >= 3) {\r\n\t\t\tmetaViewport = document.querySelector('meta[name=viewport]');\r\n\r\n\t\t\tif (metaViewport) {\r\n\t\t\t\t// user-scalable=no eliminates click delay.\r\n\t\t\t\tif (metaViewport.content.indexOf('user-scalable=no') !== -1) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t\t// width=device-width (or less than device-width) eliminates click delay.\r\n\t\t\t\tif (document.documentElement.scrollWidth <= window.outerWidth) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t// IE10 with -ms-touch-action: none or manipulation, which disables double-tap-to-zoom (issue #97)\r\n\tif (layer.style.msTouchAction === 'none' || layer.style.touchAction === 'manipulation') {\r\n\t\treturn true;\r\n\t}\r\n\r\n\t// Firefox version - zero for other browsers\r\n\tfirefoxVersion = +(/Firefox\\/([0-9]+)/.exec(navigator.userAgent) || [,0])[1];\r\n\r\n\tif (firefoxVersion >= 27) {\r\n\t\t// Firefox 27+ does not have tap delay if the content is not zoomable - https://bugzilla.mozilla.org/show_bug.cgi?id=922896\r\n\r\n\t\tmetaViewport = document.querySelector('meta[name=viewport]');\r\n\t\tif (metaViewport && (metaViewport.content.indexOf('user-scalable=no') !== -1 || document.documentElement.scrollWidth <= window.outerWidth)) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t}\r\n\r\n\t// IE11: prefixed -ms-touch-action is no longer supported and it's recomended to use non-prefixed version\r\n\t// http://msdn.microsoft.com/en-us/library/windows/apps/Hh767313.aspx\r\n\tif (layer.style.touchAction === 'none' || layer.style.touchAction === 'manipulation') {\r\n\t\treturn true;\r\n\t}\r\n\r\n\treturn false;\r\n};\r\n\r\n\r\n/**\r\n * Factory method for creating a FastClick object\r\n *\r\n * @param {Element} layer The layer to listen on\r\n * @param {Object} [options={}] The options to override the defaults\r\n */\r\nFastClick.attach = function(layer, options) {\r\n\treturn new FastClick(layer, options);\r\n};\r\n\r\nexport default FastClick\r\n","var ImageFilters = {};\r\nImageFilters.utils = {\r\n    initSampleCanvas: function () {\r\n        var _canvas = document.createElement('canvas'),\r\n            _context = _canvas.getContext('2d');\r\n        \r\n        _canvas.width = 0;\r\n        _canvas.height = 0;\r\n        \r\n        this.getSampleCanvas = function () {\r\n            return _canvas;\r\n        };\r\n        this.getSampleContext = function () {\r\n            return _context;\r\n        };\r\n        this.createImageData = (_context.createImageData) ? function (w, h) {\r\n                return _context.createImageData(w, h);\r\n            } : function (w, h) {\r\n                return new ImageData(w, h);\r\n            };\r\n    },\r\n    getSampleCanvas: function () {\r\n        this.initSampleCanvas();\r\n        return this.getSampleCanvas();\r\n    },\r\n    getSampleContext: function () {\r\n        this.initSampleCanvas();\r\n        return this.getSampleContext();\r\n    },\r\n    createImageData: function (w, h) {\r\n        this.initSampleCanvas();\r\n        return this.createImageData(w, h);\r\n    },\r\n    clamp: function (value) {\r\n        return value > 255 ? 255 : value < 0 ? 0 : value;\r\n    },\r\n    buildMap: function (f) {\r\n        for (var m = [], k = 0, v; k < 256; k += 1) {\r\n            m[k] = (v = f(k)) > 255 ? 255 : v < 0 ? 0 : v | 0;\r\n        }\r\n        return m;\r\n    },\r\n    applyMap: function (src, dst, map) {\r\n        for (var i = 0, l = src.length; i < l; i += 4) {\r\n            dst[i]     = map[src[i]];\r\n            dst[i + 1] = map[src[i + 1]];\r\n            dst[i + 2] = map[src[i + 2]];\r\n            dst[i + 3] = src[i + 3];\r\n        }\r\n    },\r\n    mapRGB: function (src, dst, func) {\r\n        this.applyMap(src, dst, this.buildMap(func));\r\n    },\r\n    getPixelIndex: function (x, y, width, height, edge) {\r\n        if (x < 0 || x >= width || y < 0 || y >= height) {\r\n            switch (edge) {\r\n            case 1: // clamp\r\n                x = x < 0 ? 0 : x >= width ? width - 1 : x;\r\n                y = y < 0 ? 0 : y >= height ? height - 1 : y;\r\n                break;\r\n            case 2: // wrap\r\n                x = (x %= width) < 0 ? x + width : x;\r\n                y = (y %= height) < 0 ? y + height : y;\r\n                break;\r\n            default: // transparent\r\n                return null;\r\n            }\r\n        }\r\n        return (y * width + x) << 2;\r\n    },\r\n    getPixel: function (src, x, y, width, height, edge) {\r\n        if (x < 0 || x >= width || y < 0 || y >= height) {\r\n            switch (edge) {\r\n            case 1: // clamp\r\n                x = x < 0 ? 0 : x >= width ? width - 1 : x;\r\n                y = y < 0 ? 0 : y >= height ? height - 1 : y;\r\n                break;\r\n            case 2: // wrap\r\n                x = (x %= width) < 0 ? x + width : x;\r\n                y = (y %= height) < 0 ? y + height : y;\r\n                break;\r\n            default: // transparent\r\n                return 0;\r\n            }\r\n        }\r\n        \r\n        var i = (y * width + x) << 2;\r\n        \r\n        // ARGB\r\n        return src[i + 3] << 24 | src[i] << 16 | src[i + 1] << 8 | src[i + 2];\r\n    },\r\n    getPixelByIndex: function (src, i) {\r\n        return src[i + 3] << 24 | src[i] << 16 | src[i + 1] << 8 | src[i + 2];\r\n    },\r\n    /**\r\n     * one of the most important functions in this library.\r\n     * I want to make this as fast as possible.\r\n     */\r\n    copyBilinear: function (src, x, y, width, height, dst, dstIndex, edge) {\r\n        var fx = x < 0 ? x - 1 | 0 : x | 0, // Math.floor(x)\r\n            fy = y < 0 ? y - 1 | 0 : y | 0, // Math.floor(y)\r\n            wx = x - fx,\r\n            wy = y - fy,\r\n            i,\r\n            nw = 0, ne = 0, sw = 0, se = 0,\r\n            cx, cy,\r\n            r, g, b, a;\r\n        \r\n        if (fx >= 0 && fx < (width - 1) && fy >= 0 && fy < (height - 1)) {\r\n            // in bounds, no edge actions required\r\n            i = (fy * width + fx) << 2;\r\n            \r\n            if (wx || wy) {\r\n                nw = src[i + 3] << 24 | src[i] << 16 | src[i + 1] << 8 | src[i + 2];\r\n                \r\n                i += 4;\r\n                ne = src[i + 3] << 24 | src[i] << 16 | src[i + 1] << 8 | src[i + 2];\r\n                \r\n                i = (i - 8) + (width << 2);\r\n                sw = src[i + 3] << 24 | src[i] << 16 | src[i + 1] << 8 | src[i + 2];\r\n                \r\n                i += 4;\r\n                se = src[i + 3] << 24 | src[i] << 16 | src[i + 1] << 8 | src[i + 2];\r\n            }\r\n            else {\r\n                // no interpolation required\r\n                dst[dstIndex]     = src[i];\r\n                dst[dstIndex + 1] = src[i + 1];\r\n                dst[dstIndex + 2] = src[i + 2];\r\n                dst[dstIndex + 3] = src[i + 3];\r\n                return;\r\n            }\r\n        }\r\n        else {\r\n            // edge actions required\r\n            nw = this.getPixel(src, fx, fy, width, height, edge);\r\n            \r\n            if (wx || wy) {\r\n                ne = this.getPixel(src, fx + 1, fy, width, height, edge);\r\n                sw = this.getPixel(src, fx, fy + 1, width, height, edge);\r\n                se = this.getPixel(src, fx + 1, fy + 1, width, height, edge);\r\n            }\r\n            else {\r\n                // no interpolation required\r\n                dst[dstIndex]     = nw >> 16 & 0xFF;\r\n                dst[dstIndex + 1] = nw >> 8  & 0xFF;\r\n                dst[dstIndex + 2] = nw       & 0xFF;\r\n                dst[dstIndex + 3] = nw >> 24 & 0xFF;\r\n                return;\r\n            }\r\n        }\r\n        \r\n        cx = 1 - wx;\r\n        cy = 1 - wy;\r\n        r = ((nw >> 16 & 0xFF) * cx + (ne >> 16 & 0xFF) * wx) * cy + ((sw >> 16 & 0xFF) * cx + (se >> 16 & 0xFF) * wx) * wy;\r\n        g = ((nw >> 8  & 0xFF) * cx + (ne >> 8  & 0xFF) * wx) * cy + ((sw >> 8  & 0xFF) * cx + (se >> 8  & 0xFF) * wx) * wy;\r\n        b = ((nw       & 0xFF) * cx + (ne       & 0xFF) * wx) * cy + ((sw       & 0xFF) * cx + (se       & 0xFF) * wx) * wy;\r\n        a = ((nw >> 24 & 0xFF) * cx + (ne >> 24 & 0xFF) * wx) * cy + ((sw >> 24 & 0xFF) * cx + (se >> 24 & 0xFF) * wx) * wy;\r\n        \r\n        dst[dstIndex]     = r > 255 ? 255 : r < 0 ? 0 : r | 0;\r\n        dst[dstIndex + 1] = g > 255 ? 255 : g < 0 ? 0 : g | 0;\r\n        dst[dstIndex + 2] = b > 255 ? 255 : b < 0 ? 0 : b | 0;\r\n        dst[dstIndex + 3] = a > 255 ? 255 : a < 0 ? 0 : a | 0;\r\n    },\r\n    /**\r\n     * @param r 0 <= n <= 255\r\n     * @param g 0 <= n <= 255\r\n     * @param b 0 <= n <= 255\r\n     * @return Array(h, s, l)\r\n     */\r\n    rgbToHsl: function (r, g, b) {\r\n        r /= 255;\r\n        g /= 255;\r\n        b /= 255;\r\n\r\n//        var max = Math.max(r, g, b),\r\n//            min = Math.min(r, g, b),\r\n        var max = (r > g) ? (r > b) ? r : b : (g > b) ? g : b,\r\n            min = (r < g) ? (r < b) ? r : b : (g < b) ? g : b,\r\n            chroma = max - min,\r\n            h = 0,\r\n            s = 0,\r\n            // Lightness\r\n            l = (min + max) / 2;\r\n\r\n        if (chroma !== 0) {\r\n            // Hue\r\n            if (r === max) {\r\n                h = (g - b) / chroma + ((g < b) ? 6 : 0);\r\n            }\r\n            else if (g === max) {\r\n                h = (b - r) / chroma + 2;\r\n            }\r\n            else {\r\n                h = (r - g) / chroma + 4;\r\n            }\r\n            h /= 6;\r\n\r\n            // Saturation\r\n            s = (l > 0.5) ? chroma / (2 - max - min) : chroma / (max + min);\r\n        }\r\n\r\n        return [h, s, l];\r\n    },\r\n    /**\r\n     * @param h 0.0 <= n <= 1.0\r\n     * @param s 0.0 <= n <= 1.0\r\n     * @param l 0.0 <= n <= 1.0\r\n     * @return Array(r, g, b)\r\n     */\r\n    hslToRgb: function (h, s, l) {\r\n        var m1, m2, hue,\r\n            r, g, b,\r\n            rgb = [];\r\n\r\n        if (s === 0) {\r\n            r = g = b = l * 255 + 0.5 | 0;\r\n            rgb = [r, g, b];\r\n        }\r\n        else {\r\n            if (l <= 0.5) {\r\n                m2 = l * (s + 1);\r\n            }\r\n            else {\r\n                m2 = l + s - l * s;\r\n            }\r\n\r\n            m1 = l * 2 - m2;\r\n            hue = h + 1 / 3;\r\n\r\n            var tmp;\r\n            for (var i = 0; i < 3; i += 1) {\r\n                if (hue < 0) {\r\n                    hue += 1;\r\n                }\r\n                else if (hue > 1) {\r\n                    hue -= 1;\r\n                }\r\n\r\n                if (6 * hue < 1) {\r\n                    tmp = m1 + (m2 - m1) * hue * 6;\r\n                }\r\n                else if (2 * hue < 1) {\r\n                    tmp = m2;\r\n                }\r\n                else if (3 * hue < 2) {\r\n                    tmp = m1 + (m2 - m1) * (2 / 3 - hue) * 6;\r\n                }\r\n                else {\r\n                    tmp = m1;\r\n                }\r\n\r\n                rgb[i] = tmp * 255 + 0.5 | 0;\r\n\r\n                hue -= 1 / 3;\r\n            }\r\n        }\r\n\r\n        return rgb;\r\n    }\r\n};\r\n\r\n\r\n// TODO\r\nImageFilters.Translate = function (srcImageData, x, y, interpolation) {\r\n\r\n};\r\nImageFilters.Scale = function (srcImageData, scaleX, scaleY, interpolation) {\r\n\r\n};\r\nImageFilters.Rotate = function (srcImageData, originX, originY, angle, resize, interpolation) {\r\n\r\n};\r\nImageFilters.Affine = function (srcImageData, matrix, resize, interpolation) {\r\n\r\n};\r\nImageFilters.UnsharpMask = function (srcImageData, level) {\r\n\r\n};\r\n\r\nImageFilters.ConvolutionFilter = function (srcImageData, matrixX, matrixY, matrix, divisor, bias, preserveAlpha, clamp, color, alpha) {\r\n    var srcPixels    = srcImageData.data,\r\n        srcWidth     = srcImageData.width,\r\n        srcHeight    = srcImageData.height,\r\n        srcLength    = srcPixels.length,\r\n        dstImageData = this.utils.createImageData(srcWidth, srcHeight),\r\n        dstPixels    = dstImageData.data;\r\n\r\n    divisor = divisor || 1;\r\n    bias = bias || 0;\r\n\r\n    // default true\r\n    (preserveAlpha !== false) && (preserveAlpha = true);\r\n    (clamp !== false) && (clamp = true);\r\n\r\n    color = color || 0;\r\n    alpha = alpha || 0;\r\n\r\n    var index = 0,\r\n        rows = matrixX >> 1,\r\n        cols = matrixY >> 1,\r\n        clampR = color >> 16 & 0xFF,\r\n        clampG = color >>  8 & 0xFF,\r\n        clampB = color       & 0xFF,\r\n        clampA = alpha * 0xFF;\r\n\r\n    for (var y = 0; y < srcHeight; y += 1) {\r\n        for (var x = 0; x < srcWidth; x += 1, index += 4) {\r\n            var r = 0,\r\n                g = 0,\r\n                b = 0,\r\n                a = 0,\r\n                replace = false,\r\n                mIndex = 0,\r\n                v;\r\n\r\n            for (var row = -rows; row <= rows; row += 1) {\r\n                var rowIndex = y + row,\r\n                    offset;\r\n\r\n                if (0 <= rowIndex && rowIndex < srcHeight) {\r\n                    offset = rowIndex * srcWidth;\r\n                }\r\n                else if (clamp) {\r\n                    offset = y * srcWidth;\r\n                }\r\n                else {\r\n                    replace = true;\r\n                }\r\n\r\n                for (var col = -cols; col <= cols; col += 1) {\r\n                    var m = matrix[mIndex++];\r\n\r\n                    if (m !== 0) {\r\n                        var colIndex = x + col;\r\n\r\n                        if (!(0 <= colIndex && colIndex < srcWidth)) {\r\n                            if (clamp) {\r\n                                colIndex = x;\r\n                            }\r\n                            else {\r\n                                replace = true;\r\n                            }\r\n                        }\r\n\r\n                        if (replace) {\r\n                            r += m * clampR;\r\n                            g += m * clampG;\r\n                            b += m * clampB;\r\n                            a += m * clampA;\r\n                        }\r\n                        else {\r\n                            var p = (offset + colIndex) << 2;\r\n                            r += m * srcPixels[p];\r\n                            g += m * srcPixels[p + 1];\r\n                            b += m * srcPixels[p + 2];\r\n                            a += m * srcPixels[p + 3];\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            dstPixels[index]     = (v = r / divisor + bias) > 255 ? 255 : v < 0 ? 0 : v | 0;\r\n            dstPixels[index + 1] = (v = g / divisor + bias) > 255 ? 255 : v < 0 ? 0 : v | 0;\r\n            dstPixels[index + 2] = (v = b / divisor + bias) > 255 ? 255 : v < 0 ? 0 : v | 0;\r\n            dstPixels[index + 3] = preserveAlpha ? srcPixels[index + 3] : (v = a / divisor + bias) > 255 ? 255 : v < 0 ? 0 : v | 0;\r\n        }\r\n    }\r\n\r\n    return dstImageData;\r\n};\r\n\r\n/**\r\n * @param threshold 0.0 <= n <= 1.0\r\n */\r\nImageFilters.Binarize = function (srcImageData, threshold) {\r\n    var srcPixels    = srcImageData.data,\r\n        srcWidth     = srcImageData.width,\r\n        srcHeight    = srcImageData.height,\r\n        srcLength    = srcPixels.length,\r\n        dstImageData = this.utils.createImageData(srcWidth, srcHeight),\r\n        dstPixels    = dstImageData.data;\r\n\r\n    if (isNaN(threshold)) {\r\n        threshold = 0.5;\r\n    }\r\n\r\n    threshold *= 255;\r\n\r\n    for (var i = 0; i < srcLength; i += 4) {\r\n        var avg = srcPixels[i] + srcPixels[i + 1] + srcPixels[i + 2] / 3;\r\n\r\n        dstPixels[i] = dstPixels[i + 1] = dstPixels[i + 2] = avg <= threshold ? 0 : 255;\r\n        dstPixels[i + 3] = 255;\r\n    }\r\n\r\n    return dstImageData;\r\n};\r\n\r\nImageFilters.BlendAdd = function (srcImageData, blendImageData, dx, dy) {\r\n    var srcPixels    = srcImageData.data,\r\n        srcWidth     = srcImageData.width,\r\n        srcHeight    = srcImageData.height,\r\n        srcLength    = srcPixels.length,\r\n        dstImageData = this.utils.createImageData(srcWidth, srcHeight),\r\n        dstPixels    = dstImageData.data,\r\n        blendPixels  = blendImageData.data;\r\n\r\n    var v;\r\n\r\n    for (var i = 0; i < srcLength; i += 4) {\r\n        dstPixels[i]     = ((v = srcPixels[i]     + blendPixels[i])     > 255) ? 255 : v;\r\n        dstPixels[i + 1] = ((v = srcPixels[i + 1] + blendPixels[i + 1]) > 255) ? 255 : v;\r\n        dstPixels[i + 2] = ((v = srcPixels[i + 2] + blendPixels[i + 2]) > 255) ? 255 : v;\r\n        dstPixels[i + 3] = 255;\r\n    }\r\n\r\n    return dstImageData;\r\n};\r\n\r\nImageFilters.BlendSubtract = function (srcImageData, blendImageData, dx, dy) {\r\n    var srcPixels    = srcImageData.data,\r\n        srcWidth     = srcImageData.width,\r\n        srcHeight    = srcImageData.height,\r\n        srcLength    = srcPixels.length,\r\n        dstImageData = this.utils.createImageData(srcWidth, srcHeight),\r\n        dstPixels    = dstImageData.data,\r\n        blendPixels  = blendImageData.data;\r\n\r\n    var v;\r\n\r\n    for (var i = 0; i < srcLength; i += 4) {\r\n        dstPixels[i]     = ((v = srcPixels[i]     - blendPixels[i])     < 0) ? 0 : v;\r\n        dstPixels[i + 1] = ((v = srcPixels[i + 1] - blendPixels[i + 1]) < 0) ? 0 : v;\r\n        dstPixels[i + 2] = ((v = srcPixels[i + 2] - blendPixels[i + 2]) < 0) ? 0 : v;\r\n        dstPixels[i + 3] = 255;\r\n    }\r\n\r\n    return dstImageData;\r\n};\r\n\r\n/**\r\n * Algorithm based on BoxBlurFilter.java by Huxtable.com\r\n * @see http://www.jhlabs.com/ip/blurring.html\r\n * Copyright 2005 Huxtable.com. All rights reserved.\r\n */\r\nImageFilters.BoxBlur = (function () {\r\n    var blur = function(src, dst, width, height, radius) {\r\n        var tableSize = radius * 2 + 1;\r\n        var radiusPlus1 = radius + 1;\r\n        var widthMinus1 = width - 1;\r\n\r\n        var r, g, b, a;\r\n\r\n        var srcIndex = 0;\r\n        var dstIndex;\r\n        var p, next, prev;\r\n        var i, l, x, y,\r\n            nextIndex, prevIndex;\r\n\r\n        var sumTable = [];\r\n        for (i = 0, l = 256 * tableSize; i < l; i += 1) {\r\n            sumTable[i] = i / tableSize | 0;\r\n        }\r\n\r\n        for (y = 0; y < height; y += 1) {\r\n            r = g = b = a = 0;\r\n            dstIndex = y;\r\n\r\n            p = srcIndex << 2;\r\n            r += radiusPlus1 * src[p];\r\n            g += radiusPlus1 * src[p + 1];\r\n            b += radiusPlus1 * src[p + 2];\r\n            a += radiusPlus1 * src[p + 3];\r\n\r\n            for (i = 1; i <= radius; i += 1) {\r\n                p = (srcIndex + (i < width ? i : widthMinus1)) << 2;\r\n                r += src[p];\r\n                g += src[p + 1];\r\n                b += src[p + 2];\r\n                a += src[p + 3];\r\n            }\r\n\r\n            for (x = 0; x < width; x += 1) {\r\n                p = dstIndex << 2;\r\n                dst[p]     = sumTable[r];\r\n                dst[p + 1] = sumTable[g];\r\n                dst[p + 2] = sumTable[b];\r\n                dst[p + 3] = sumTable[a];\r\n\r\n                nextIndex = x + radiusPlus1;\r\n                if (nextIndex > widthMinus1) {\r\n                    nextIndex = widthMinus1;\r\n                }\r\n\r\n                prevIndex = x - radius;\r\n                if (prevIndex < 0) {\r\n                    prevIndex = 0;\r\n                }\r\n\r\n                next = (srcIndex + nextIndex) << 2;\r\n                prev = (srcIndex + prevIndex) << 2;\r\n\r\n                r += src[next]     - src[prev];\r\n                g += src[next + 1] - src[prev + 1];\r\n                b += src[next + 2] - src[prev + 2];\r\n                a += src[next + 3] - src[prev + 3];\r\n                \r\n                dstIndex += height;\r\n            }\r\n            srcIndex += width;\r\n        }\r\n    };\r\n    \r\n    return function (srcImageData, hRadius, vRadius, quality) {\r\n        var srcPixels    = srcImageData.data,\r\n            srcWidth     = srcImageData.width,\r\n            srcHeight    = srcImageData.height,\r\n            srcLength    = srcPixels.length,\r\n            dstImageData = this.utils.createImageData(srcWidth, srcHeight),\r\n            dstPixels    = dstImageData.data,\r\n            tmpImageData = this.utils.createImageData(srcWidth, srcHeight),\r\n            tmpPixels    = tmpImageData.data;\r\n\r\n        for (var i = 0; i < quality; i += 1) {\r\n            // only use the srcPixels on the first loop\r\n            blur(i ? dstPixels : srcPixels, tmpPixels, srcWidth, srcHeight, hRadius);\r\n            blur(tmpPixels, dstPixels, srcHeight, srcWidth, vRadius);\r\n        }\r\n\r\n        return dstImageData;\r\n    };\r\n}());\r\n\r\n/**\r\n * @ param strength 1 <= n <= 4\r\n */\r\nImageFilters.GaussianBlur = function (srcImageData, strength) {\r\n    var size, matrix, divisor;\r\n\r\n    switch (strength) {\r\n    case 2:\r\n        size = 5;\r\n        matrix = [\r\n            1, 1, 2, 1, 1,\r\n            1, 2, 4, 2, 1,\r\n            2, 4, 8, 4, 2,\r\n            1, 2, 4, 2, 1,\r\n            1, 1, 2, 1, 1\r\n        ];\r\n        divisor = 52;\r\n        break;\r\n    case 3:\r\n        size = 7;\r\n        matrix = [\r\n            1, 1, 2,  2, 2, 1, 1,\r\n            1, 2, 2,  4, 2, 2, 1,\r\n            2, 2, 4,  8, 4, 2, 2,\r\n            2, 4, 8, 16, 8, 4, 2,\r\n            2, 2, 4,  8, 4, 2, 2,\r\n            1, 2, 2,  4, 2, 2, 1,\r\n            1, 1, 2,  2, 2, 1, 1\r\n        ];\r\n        divisor = 140;\r\n        break;\r\n    case 4:\r\n        size = 15;\r\n        matrix = [\r\n            2 ,2 , 3 , 4 , 5 , 5 , 6 , 6 , 6 , 5 , 5 , 4 , 3 ,2 ,2,\r\n            2 ,3 , 4 , 5 , 7 , 7 , 8 , 8 , 8 , 7 , 7 , 5 , 4 ,3 ,2,\r\n            3 ,4 , 6 , 7 , 9 ,10 ,10 ,11 ,10 ,10 , 9 , 7 , 6 ,4 ,3,\r\n            4 ,5 , 7 , 9 ,10 ,12 ,13 ,13 ,13 ,12 ,10 , 9 , 7 ,5 ,4,\r\n            5 ,7 , 9 ,11 ,13 ,14 ,15 ,16 ,15 ,14 ,13 ,11 , 9 ,7 ,5,\r\n            5 ,7 ,10 ,12 ,14 ,16 ,17 ,18 ,17 ,16 ,14 ,12 ,10 ,7 ,5,\r\n            6 ,8 ,10 ,13 ,15 ,17 ,19 ,19 ,19 ,17 ,15 ,13 ,10 ,8 ,6,\r\n            6 ,8 ,11 ,13 ,16 ,18 ,19 ,20 ,19 ,18 ,16 ,13 ,11 ,8 ,6,\r\n            6 ,8 ,10 ,13 ,15 ,17 ,19 ,19 ,19 ,17 ,15 ,13 ,10 ,8 ,6,\r\n            5 ,7 ,10 ,12 ,14 ,16 ,17 ,18 ,17 ,16 ,14 ,12 ,10 ,7 ,5,\r\n            5 ,7 , 9 ,11 ,13 ,14 ,15 ,16 ,15 ,14 ,13 ,11 , 9 ,7 ,5,\r\n            4 ,5 , 7 , 9 ,10 ,12 ,13 ,13 ,13 ,12 ,10 , 9 , 7 ,5 ,4,\r\n            3 ,4 , 6 , 7 , 9 ,10 ,10 ,11 ,10 ,10 , 9 , 7 , 6 ,4 ,3,\r\n            2 ,3 , 4 , 5 , 7 , 7 , 8 , 8 , 8 , 7 , 7 , 5 , 4 ,3 ,2,\r\n            2 ,2 , 3 , 4 , 5 , 5 , 6 , 6 , 6 , 5 , 5 , 4 , 3 ,2 ,2\r\n        ];\r\n        divisor = 2044;\r\n        break;\r\n    default:\r\n        size = 3;\r\n        matrix = [\r\n            1, 2, 1,\r\n            2, 4, 2,\r\n            1, 2, 1\r\n        ];\r\n        divisor = 16;\r\n        break;\r\n    }\r\n    return this.ConvolutionFilter(srcImageData, size, size, matrix, divisor, 0, false);\r\n};\r\n\r\n/**\r\n * Stack Blur Algorithm by Mario Klingemann <mario@quasimondo.com>\r\n * @see http://incubator.quasimondo.com/processing/fast_blur_deluxe.php\r\n */\r\n/*\r\nCopyright (c) 2010 Mario Klingemann\r\n\r\nPermission is hereby granted, free of charge, to any person\r\nobtaining a copy of this software and associated documentation\r\nfiles (the \"Software\"), to deal in the Software without\r\nrestriction, including without limitation the rights to use,\r\ncopy, modify, merge, publish, distribute, sublicense, and/or sell\r\ncopies of the Software, and to permit persons to whom the\r\nSoftware is furnished to do so, subject to the following\r\nconditions:\r\n\r\nThe above copyright notice and this permission notice shall be\r\nincluded in all copies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\r\nEXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\r\nOF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\r\nNONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\r\nHOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\r\nWHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\r\nFROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\r\nOTHER DEALINGS IN THE SOFTWARE.\r\n*/\r\nImageFilters.StackBlur = (function () {\r\n    var mul_table = [\r\n        512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,\r\n        454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,\r\n        482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,\r\n        437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,\r\n        497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,\r\n        320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,\r\n        446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,\r\n        329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,\r\n        505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,\r\n        399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,\r\n        324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,\r\n        268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,\r\n        451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,\r\n        385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,\r\n        332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,\r\n        289,287,285,282,280,278,275,273,271,269,267,265,263,261,259];\r\n        \r\n   \r\n    var shg_table = [\r\n         9, 11, 12, 13, 13, 14, 14, 15, 15, 15, 15, 16, 16, 16, 16, 17, \r\n        17, 17, 17, 17, 17, 17, 18, 18, 18, 18, 18, 18, 18, 18, 18, 19, \r\n        19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 20, 20, 20,\r\n        20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 21,\r\n        21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21,\r\n        21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 22, 22, 22, 22, 22, 22, \r\n        22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22,\r\n        22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 23, \r\n        23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23,\r\n        23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23,\r\n        23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, \r\n        23, 23, 23, 23, 23, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, \r\n        24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,\r\n        24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,\r\n        24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,\r\n        24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24 ];\r\n    \r\n    function BlurStack() {\r\n        this.r = 0;\r\n        this.g = 0;\r\n        this.b = 0;\r\n        this.a = 0;\r\n        this.next = null;\r\n    }\r\n    \r\n    return function (srcImageData, radius) {\r\n        var srcPixels    = srcImageData.data,\r\n            srcWidth     = srcImageData.width,\r\n            srcHeight    = srcImageData.height,\r\n            srcLength    = srcPixels.length,\r\n            dstImageData = this.Clone(srcImageData),\r\n            dstPixels    = dstImageData.data;\r\n\r\n        var x, y, i, p, yp, yi, yw,\r\n            r_sum, g_sum, b_sum, a_sum, \r\n            r_out_sum, g_out_sum, b_out_sum, a_out_sum,\r\n            r_in_sum, g_in_sum, b_in_sum, a_in_sum, \r\n            pr, pg, pb, pa, rbs,\r\n            div = radius + radius + 1,\r\n            w4 = srcWidth << 2,\r\n            widthMinus1  = srcWidth - 1,\r\n            heightMinus1 = srcHeight - 1,\r\n            radiusPlus1  = radius + 1,\r\n            sumFactor = radiusPlus1 * ( radiusPlus1 + 1 ) / 2,\r\n            stackStart = new BlurStack(),\r\n            stack = stackStart,\r\n            stackIn, stackOut, stackEnd,\r\n            mul_sum = mul_table[radius],\r\n            shg_sum = shg_table[radius];\r\n        \r\n        for (i = 1; i < div; i += 1) {\r\n            stack = stack.next = new BlurStack();\r\n            if (i == radiusPlus1) {\r\n                stackEnd = stack;\r\n            }\r\n        }\r\n        \r\n        stack.next = stackStart;\r\n        yw = yi = 0;\r\n        \r\n        for (y = 0; y < srcHeight; y += 1) {\r\n            r_in_sum = g_in_sum = b_in_sum = a_in_sum = r_sum = g_sum = b_sum = a_sum = 0;\r\n            \r\n            r_out_sum = radiusPlus1 * (pr = dstPixels[yi]);\r\n            g_out_sum = radiusPlus1 * (pg = dstPixels[yi + 1]);\r\n            b_out_sum = radiusPlus1 * (pb = dstPixels[yi + 2]);\r\n            a_out_sum = radiusPlus1 * (pa = dstPixels[yi + 3]);\r\n            \r\n            r_sum += sumFactor * pr;\r\n            g_sum += sumFactor * pg;\r\n            b_sum += sumFactor * pb;\r\n            a_sum += sumFactor * pa;\r\n            \r\n            stack = stackStart;\r\n            \r\n            for (i = 0; i < radiusPlus1; i += 1) {\r\n                stack.r = pr;\r\n                stack.g = pg;\r\n                stack.b = pb;\r\n                stack.a = pa;\r\n                stack = stack.next;\r\n            }\r\n            \r\n            for (i = 1; i < radiusPlus1; i += 1) {\r\n                p = yi + ((widthMinus1 < i ? widthMinus1 : i) << 2);\r\n                r_sum += (stack.r = (pr = dstPixels[p])) * (rbs = radiusPlus1 - i);\r\n                g_sum += (stack.g = (pg = dstPixels[p + 1])) * rbs;\r\n                b_sum += (stack.b = (pb = dstPixels[p + 2])) * rbs;\r\n                a_sum += (stack.a = (pa = dstPixels[p + 3])) * rbs;\r\n                \r\n                r_in_sum += pr;\r\n                g_in_sum += pg;\r\n                b_in_sum += pb;\r\n                a_in_sum += pa;\r\n                \r\n                stack = stack.next;\r\n            }\r\n            \r\n            stackIn = stackStart;\r\n            stackOut = stackEnd;\r\n            \r\n            for (x = 0; x < srcWidth; x += 1) {\r\n                dstPixels[yi]     = (r_sum * mul_sum) >> shg_sum;\r\n                dstPixels[yi + 1] = (g_sum * mul_sum) >> shg_sum;\r\n                dstPixels[yi + 2] = (b_sum * mul_sum) >> shg_sum;\r\n                dstPixels[yi + 3] = (a_sum * mul_sum) >> shg_sum;\r\n                \r\n                r_sum -= r_out_sum;\r\n                g_sum -= g_out_sum;\r\n                b_sum -= b_out_sum;\r\n                a_sum -= a_out_sum;\r\n                \r\n                r_out_sum -= stackIn.r;\r\n                g_out_sum -= stackIn.g;\r\n                b_out_sum -= stackIn.b;\r\n                a_out_sum -= stackIn.a;\r\n                \r\n                p =  (yw + ((p = x + radius + 1) < widthMinus1 ? p : widthMinus1)) << 2;\r\n                \r\n                r_in_sum += (stackIn.r = dstPixels[p]);\r\n                g_in_sum += (stackIn.g = dstPixels[p + 1]);\r\n                b_in_sum += (stackIn.b = dstPixels[p + 2]);\r\n                a_in_sum += (stackIn.a = dstPixels[p + 3]);\r\n                \r\n                r_sum += r_in_sum;\r\n                g_sum += g_in_sum;\r\n                b_sum += b_in_sum;\r\n                a_sum += a_in_sum;\r\n                \r\n                stackIn = stackIn.next;\r\n                \r\n                r_out_sum += (pr = stackOut.r);\r\n                g_out_sum += (pg = stackOut.g);\r\n                b_out_sum += (pb = stackOut.b);\r\n                a_out_sum += (pa = stackOut.a);\r\n                \r\n                r_in_sum -= pr;\r\n                g_in_sum -= pg;\r\n                b_in_sum -= pb;\r\n                a_in_sum -= pa;\r\n                \r\n                stackOut = stackOut.next;\r\n\r\n                yi += 4;\r\n            }\r\n            \r\n            yw += srcWidth;\r\n        }\r\n        \r\n        for (x = 0; x < srcWidth; x += 1) {\r\n            g_in_sum = b_in_sum = a_in_sum = r_in_sum = g_sum = b_sum = a_sum = r_sum = 0;\r\n            \r\n            yi = x << 2;\r\n            r_out_sum = radiusPlus1 * (pr = dstPixels[yi]);\r\n            g_out_sum = radiusPlus1 * (pg = dstPixels[yi + 1]);\r\n            b_out_sum = radiusPlus1 * (pb = dstPixels[yi + 2]);\r\n            a_out_sum = radiusPlus1 * (pa = dstPixels[yi + 3]);\r\n            \r\n            r_sum += sumFactor * pr;\r\n            g_sum += sumFactor * pg;\r\n            b_sum += sumFactor * pb;\r\n            a_sum += sumFactor * pa;\r\n            \r\n            stack = stackStart;\r\n            \r\n            for (i = 0; i < radiusPlus1; i += 1) {\r\n                stack.r = pr;\r\n                stack.g = pg;\r\n                stack.b = pb;\r\n                stack.a = pa;\r\n                stack = stack.next;\r\n            }\r\n            \r\n            yp = srcWidth;\r\n            \r\n            for (i = 1; i <= radius; i += 1) {\r\n                yi = (yp + x) << 2;\r\n                \r\n                r_sum += (stack.r = (pr = dstPixels[yi])) * (rbs = radiusPlus1 - i);\r\n                g_sum += (stack.g = (pg = dstPixels[yi + 1])) * rbs;\r\n                b_sum += (stack.b = (pb = dstPixels[yi + 2])) * rbs;\r\n                a_sum += (stack.a = (pa = dstPixels[yi + 3])) * rbs;\r\n               \r\n                r_in_sum += pr;\r\n                g_in_sum += pg;\r\n                b_in_sum += pb;\r\n                a_in_sum += pa;\r\n                \r\n                stack = stack.next;\r\n            \r\n                if (i < heightMinus1) {\r\n                    yp += srcWidth;\r\n                }\r\n            }\r\n            \r\n            yi = x;\r\n            stackIn = stackStart;\r\n            stackOut = stackEnd;\r\n            \r\n            for (y = 0; y < srcHeight; y += 1) {\r\n                p = yi << 2;\r\n                dstPixels[p]     = (r_sum * mul_sum) >> shg_sum;\r\n                dstPixels[p + 1] = (g_sum * mul_sum) >> shg_sum;\r\n                dstPixels[p + 2] = (b_sum * mul_sum) >> shg_sum;\r\n                dstPixels[p + 3] = (a_sum * mul_sum) >> shg_sum;\r\n                \r\n                r_sum -= r_out_sum;\r\n                g_sum -= g_out_sum;\r\n                b_sum -= b_out_sum;\r\n                a_sum -= a_out_sum;\r\n               \r\n                r_out_sum -= stackIn.r;\r\n                g_out_sum -= stackIn.g;\r\n                b_out_sum -= stackIn.b;\r\n                a_out_sum -= stackIn.a;\r\n                \r\n                p = (x + (((p = y + radiusPlus1) < heightMinus1 ? p : heightMinus1) * srcWidth)) << 2;\r\n                \r\n                r_sum += (r_in_sum += (stackIn.r = dstPixels[p]));\r\n                g_sum += (g_in_sum += (stackIn.g = dstPixels[p + 1]));\r\n                b_sum += (b_in_sum += (stackIn.b = dstPixels[p + 2]));\r\n                a_sum += (a_in_sum += (stackIn.a = dstPixels[p + 3]));\r\n               \r\n                stackIn = stackIn.next;\r\n                \r\n                r_out_sum += (pr = stackOut.r);\r\n                g_out_sum += (pg = stackOut.g);\r\n                b_out_sum += (pb = stackOut.b);\r\n                a_out_sum += (pa = stackOut.a);\r\n                \r\n                r_in_sum -= pr;\r\n                g_in_sum -= pg;\r\n                b_in_sum -= pb;\r\n                a_in_sum -= pa;\r\n                \r\n                stackOut = stackOut.next;\r\n                \r\n                yi += srcWidth;\r\n            }\r\n        }\r\n        \r\n        return dstImageData;\r\n    }\r\n}());\r\n\r\n/**\r\n * TV based algorithm\r\n */\r\nImageFilters.Brightness = function (srcImageData, brightness) {\r\n    var srcPixels    = srcImageData.data,\r\n        srcWidth     = srcImageData.width,\r\n        srcHeight    = srcImageData.height,\r\n        srcLength    = srcPixels.length,\r\n        dstImageData = this.utils.createImageData(srcWidth, srcHeight),\r\n        dstPixels    = dstImageData.data;\r\n\r\n    this.utils.mapRGB(srcPixels, dstPixels, function (value) {\r\n        value += brightness;\r\n        return (value > 255) ? 255 : value;\r\n    });\r\n\r\n    return dstImageData;\r\n};\r\n\r\n/**\r\n * GIMP algorithm modified. pretty close to fireworks\r\n * @param brightness -100 <= n <= 100\r\n * @param contrast -100 <= n <= 100\r\n */\r\nImageFilters.BrightnessContrastGimp = function (srcImageData, brightness, contrast) {\r\n    var srcPixels    = srcImageData.data,\r\n        srcWidth     = srcImageData.width,\r\n        srcHeight    = srcImageData.height,\r\n        srcLength    = srcPixels.length,\r\n        dstImageData = this.utils.createImageData(srcWidth, srcHeight),\r\n        dstPixels    = dstImageData.data,\r\n        p4           = Math.PI / 4;\r\n\r\n    // fix to -1 <= n <= 1\r\n    brightness /= 100;\r\n    \r\n    // fix to -99 <= n <= 99\r\n    contrast *= 0.99;\r\n    // fix to -1 < n < 1\r\n    contrast /= 100;\r\n    // apply GIMP formula\r\n    contrast = Math.tan((contrast + 1) * p4);\r\n\r\n    // get the average color\r\n    for (var avg = 0, i = 0; i < srcLength; i += 4) {\r\n        avg += (srcPixels[i] * 19595 + srcPixels[i + 1] * 38470 + srcPixels[i + 2] * 7471) >> 16;\r\n    }\r\n    avg = avg / (srcLength / 4);\r\n\r\n    this.utils.mapRGB(srcPixels, dstPixels, function (value) {\r\n        if (brightness < 0) {\r\n            value = value * (1 + brightness);\r\n        }\r\n        else if (brightness > 0) {\r\n            value = value + ((255 - value) * brightness);\r\n        }\r\n        //value += brightness;\r\n\r\n        if (contrast !== 0) {\r\n            value = (value - avg) * contrast + avg;\r\n        }\r\n        return value + 0.5 | 0;\r\n    });\r\n    return dstImageData;\r\n};\r\n\r\n/**\r\n * more like the new photoshop algorithm\r\n * @param brightness -100 <= n <= 100\r\n * @param contrast -100 <= n <= 100\r\n */\r\nImageFilters.BrightnessContrastPhotoshop = function (srcImageData, brightness, contrast) {\r\n    var srcPixels    = srcImageData.data,\r\n        srcWidth     = srcImageData.width,\r\n        srcHeight    = srcImageData.height,\r\n        srcLength    = srcPixels.length,\r\n        dstImageData = this.utils.createImageData(srcWidth, srcHeight),\r\n        dstPixels    = dstImageData.data;\r\n\r\n    // fix to 0 <= n <= 2;\r\n    brightness = (brightness + 100) / 100;\r\n    contrast = (contrast + 100) / 100;\r\n\r\n    this.utils.mapRGB(srcPixels, dstPixels, function (value) {\r\n        value *= brightness;\r\n        value = (value - 127.5) * contrast + 127.5;\r\n        return value + 0.5 | 0;\r\n    });\r\n    return dstImageData;\r\n};\r\n\r\nImageFilters.Channels = function (srcImageData, channel) {\r\n    var matrix;\r\n\r\n    switch (channel) {\r\n        case 2: // green\r\n            matrix = [\r\n                0, 1, 0, 0, 0,\r\n                0, 1, 0, 0, 0,\r\n                0, 1, 0, 0, 0,\r\n                0, 0, 0, 1, 0\r\n            ];\r\n            break;\r\n        case 3: // blue\r\n            matrix = [\r\n                0, 0, 1, 0, 0,\r\n                0, 0, 1, 0, 0,\r\n                0, 0, 1, 0, 0,\r\n                0, 0, 0, 1, 0\r\n            ];\r\n            break;\r\n        default: // red\r\n            matrix = [\r\n                1, 0, 0, 0, 0,\r\n                1, 0, 0, 0, 0,\r\n                1, 0, 0, 0, 0,\r\n                0, 0, 0, 1, 0\r\n            ];\r\n            break;\r\n\r\n    }\r\n\r\n    return this.ColorMatrixFilter(srcImageData, matrix);\r\n};\r\n\r\nImageFilters.Clone = function (srcImageData) {\r\n    return this.Copy(srcImageData, this.utils.createImageData(srcImageData.width, srcImageData.height));\r\n};\r\n\r\n/**\r\n * slower\r\n */\r\nImageFilters.CloneBuiltin = function (srcImageData) {\r\n    var srcWidth  = srcImageData.width,\r\n        srcHeight = srcImageData.height,\r\n        canvas    = this.utils.getSampleCanvas(),\r\n        context   = this.utils.getSampleContext(),\r\n        dstImageData;\r\n\r\n    canvas.width  = srcWidth;\r\n    canvas.height = srcHeight;\r\n\r\n    context.putImageData(srcImageData, 0, 0);\r\n    dstImageData = context.getImageData(0, 0, srcWidth, srcHeight);\r\n\r\n    canvas.width = 0;\r\n    canvas.height = 0;\r\n\r\n    return dstImageData;\r\n};\r\n\r\nImageFilters.ColorMatrixFilter = function (srcImageData, matrix) {\r\n    var srcPixels    = srcImageData.data,\r\n        srcWidth     = srcImageData.width,\r\n        srcHeight    = srcImageData.height,\r\n        srcLength    = srcPixels.length,\r\n        dstImageData = this.utils.createImageData(srcWidth, srcHeight),\r\n        dstPixels    = dstImageData.data;\r\n\r\n    var m0  = matrix[0],\r\n        m1  = matrix[1],\r\n        m2  = matrix[2],\r\n        m3  = matrix[3],\r\n        m4  = matrix[4],\r\n        m5  = matrix[5],\r\n        m6  = matrix[6],\r\n        m7  = matrix[7],\r\n        m8  = matrix[8],\r\n        m9  = matrix[9],\r\n        m10 = matrix[10],\r\n        m11 = matrix[11],\r\n        m12 = matrix[12],\r\n        m13 = matrix[13],\r\n        m14 = matrix[14],\r\n        m15 = matrix[15],\r\n        m16 = matrix[16],\r\n        m17 = matrix[17],\r\n        m18 = matrix[18],\r\n        m19 = matrix[19];\r\n\r\n    var value, i, r, g, b, a;\r\n    for (i = 0; i < srcLength; i += 4) {\r\n        r = srcPixels[i];\r\n        g = srcPixels[i + 1];\r\n        b = srcPixels[i + 2];\r\n        a = srcPixels[i + 3];\r\n\r\n        dstPixels[i]     = (value = r *  m0 + g *  m1 + b *  m2 + a *  m3 +  m4) > 255 ? 255 : value < 0 ? 0 : value | 0;\r\n        dstPixels[i + 1] = (value = r *  m5 + g *  m6 + b *  m7 + a *  m8 +  m9) > 255 ? 255 : value < 0 ? 0 : value | 0;\r\n        dstPixels[i + 2] = (value = r * m10 + g * m11 + b * m12 + a * m13 + m14) > 255 ? 255 : value < 0 ? 0 : value | 0;\r\n        dstPixels[i + 3] = (value = r * m15 + g * m16 + b * m17 + a * m18 + m19) > 255 ? 255 : value < 0 ? 0 : value | 0;\r\n    }\r\n\r\n    return dstImageData;\r\n};\r\n\r\nImageFilters.ColorTransformFilter = function (\r\n        srcImageData, redMultiplier, greenMultiplier, blueMultiplier, alphaMultiplier,\r\n        redOffset, greenOffset, blueOffset, alphaOffset) {\r\n    var srcPixels    = srcImageData.data,\r\n        srcWidth     = srcImageData.width,\r\n        srcHeight    = srcImageData.height,\r\n        srcLength    = srcPixels.length,\r\n        dstImageData = this.utils.createImageData(srcWidth, srcHeight),\r\n        dstPixels    = dstImageData.data;\r\n\r\n    var i, v;\r\n    for (i = 0; i < srcLength; i += 4) {\r\n        dstPixels[i]     = (v = srcPixels[i]     * redMultiplier   + redOffset)   > 255 ? 255 : v < 0 ? 0 : v;\r\n        dstPixels[i + 1] = (v = srcPixels[i + 1] * greenMultiplier + greenOffset) > 255 ? 255 : v < 0 ? 0 : v;\r\n        dstPixels[i + 2] = (v = srcPixels[i + 2] * blueMultiplier  + blueOffset)  > 255 ? 255 : v < 0 ? 0 : v;\r\n        dstPixels[i + 3] = (v = srcPixels[i + 3] * alphaMultiplier + alphaOffset) > 255 ? 255 : v < 0 ? 0 : v;\r\n    }\r\n\r\n    return dstImageData;\r\n};\r\n\r\nImageFilters.Copy = function (srcImageData, dstImageData) {\r\n    var srcPixels = srcImageData.data,\r\n        srcLength = srcPixels.length,\r\n        dstPixels = dstImageData.data;\r\n\r\n    while (srcLength--) {\r\n        dstPixels[srcLength] = srcPixels[srcLength];\r\n    }\r\n\r\n    return dstImageData;\r\n};\r\n\r\nImageFilters.Crop = function (srcImageData, x, y, width, height) {\r\n    var srcPixels    = srcImageData.data,\r\n        srcWidth     = srcImageData.width,\r\n        srcHeight    = srcImageData.height,\r\n        srcLength    = srcPixels.length,\r\n        dstImageData = this.utils.createImageData(width, height),\r\n        dstPixels    = dstImageData.data;\r\n\r\n    var srcLeft   = Math.max(x, 0),\r\n        srcTop    = Math.max(y, 0),\r\n        srcRight  = Math.min(x + width, srcWidth),\r\n        srcBottom = Math.min(y + height, srcHeight),\r\n        dstLeft   = srcLeft - x,\r\n        dstTop    = srcTop - y,\r\n        srcRow, srcCol, srcIndex, dstIndex;\r\n\r\n    for (srcRow = srcTop, dstRow = dstTop; srcRow < srcBottom; srcRow += 1, dstRow += 1) {\r\n        for (srcCol = srcLeft, dstCol = dstLeft; srcCol < srcRight; srcCol += 1, dstCol += 1) {\r\n            srcIndex = (srcRow * srcWidth + srcCol) << 2;\r\n            dstIndex = (dstRow * width    + dstCol) << 2;\r\n            dstPixels[dstIndex]     = srcPixels[srcIndex];\r\n            dstPixels[dstIndex + 1] = srcPixels[srcIndex + 1];\r\n            dstPixels[dstIndex + 2] = srcPixels[srcIndex + 2];\r\n            dstPixels[dstIndex + 3] = srcPixels[srcIndex + 3];\r\n        }\r\n    }\r\n\r\n    return dstImageData;\r\n};\r\n\r\nImageFilters.CropBuiltin = function (srcImageData, x, y, width, height) {\r\n    var srcWidth  = srcImageData.width,\r\n        srcHeight = srcImageData.height,\r\n        canvas    = this.utils.getSampleCanvas(),\r\n        context   = this.utils.getSampleContext();\r\n\r\n    canvas.width = srcWidth;\r\n    canvas.height = srcHeight;\r\n    context.putImageData(srcImageData, 0, 0);\r\n    var result = context.getImageData(x, y, width, height);\r\n\r\n    canvas.width = 0;\r\n    canvas.height = 0;\r\n\r\n    return result;\r\n};\r\n\r\n/**\r\n * sets to the average of the highest and lowest contrast\r\n */\r\nImageFilters.Desaturate = function (srcImageData) {\r\n    var srcPixels    = srcImageData.data,\r\n        srcWidth     = srcImageData.width,\r\n        srcHeight    = srcImageData.height,\r\n        srcLength    = srcPixels.length,\r\n        dstImageData = this.utils.createImageData(srcWidth, srcHeight),\r\n        dstPixels    = dstImageData.data;\r\n\r\n    for (var i = 0; i < srcLength; i += 4) {\r\n        var r = srcPixels[i],\r\n            g = srcPixels[i + 1],\r\n            b = srcPixels[i + 2],\r\n            max = (r > g) ? (r > b) ? r : b : (g > b) ? g : b,\r\n            min = (r < g) ? (r < b) ? r : b : (g < b) ? g : b,\r\n            avg = ((max + min) / 2) + 0.5 | 0;\r\n\r\n        dstPixels[i] = dstPixels[i + 1] = dstPixels[i + 2] = avg;\r\n        dstPixels[i + 3] = srcPixels[i + 3];\r\n    }\r\n\r\n    return dstImageData;\r\n};\r\n\r\n/**\r\n * TODO: use bilinear\r\n */\r\nImageFilters.DisplacementMapFilter = function (srcImageData, mapImageData, mapX, mapY, componentX, componentY, scaleX, scaleY, mode) {\r\n    var srcPixels    = srcImageData.data,\r\n        srcWidth     = srcImageData.width,\r\n        srcHeight    = srcImageData.height,\r\n        srcLength    = srcPixels.length,\r\n//        dstImageData = this.utils.createImageData(srcWidth, srcHeight),\r\n        dstImageData = ImageFilters.Clone(srcImageData),\r\n        dstPixels    = dstImageData.data;\r\n\r\n    mapX || (mapX = 0);\r\n    mapY || (mapY = 0);\r\n    componentX || (componentX = 0); // red?\r\n    componentY || (componentY = 0);\r\n    scaleX || (scaleX = 0);\r\n    scaleY || (scaleY = 0);\r\n    mode || (mode = 2); // wrap\r\n\r\n    var mapWidth  = mapImageData.width,\r\n        mapHeight = mapImageData.height,\r\n        mapPixels = mapImageData.data,\r\n        mapRight  = mapWidth + mapX,\r\n        mapBottom = mapHeight + mapY,\r\n        dstIndex, srcIndex, mapIndex,\r\n        cx, cy, tx, ty, x, y;\r\n\r\n    for (x = 0; x < srcWidth; x += 1) {\r\n        for (y = 0; y < srcHeight; y += 1) {\r\n\r\n            dstIndex = (y * srcWidth + x) << 2;\r\n\r\n            if (x < mapX || y < mapY || x >= mapRight || y >= mapBottom) {\r\n                // out of the map bounds\r\n                // copy src to dst\r\n                srcIndex = dstIndex;\r\n            } else {\r\n                // apply map\r\n                mapIndex = ((y - mapY) * mapWidth + (x - mapX)) << 2;\r\n\r\n                // tx = x + ((componentX(x, y) - 128) * scaleX) / 256\r\n                cx = mapPixels[mapIndex + componentX];\r\n                tx = x + (((cx - 128) * scaleX) >> 8);\r\n\r\n                // tx = y + ((componentY(x, y) - 128) * scaleY) / 256\r\n                cy = mapPixels[mapIndex + componentY];\r\n                ty = y + (((cy - 128) * scaleY) >> 8);\r\n\r\n                srcIndex = ImageFilters.utils.getPixelIndex(tx + 0.5 | 0, ty + 0.5 | 0, srcWidth, srcHeight, mode);\r\n                if (srcIndex === null) {\r\n                    // if mode == ignore and (tx,ty) is out of src bounds\r\n                    // then copy (x,y) to dst\r\n                    srcIndex = dstIndex;\r\n                }\r\n            }\r\n\r\n            dstPixels[dstIndex]     = srcPixels[srcIndex];\r\n            dstPixels[dstIndex + 1] = srcPixels[srcIndex + 1];\r\n            dstPixels[dstIndex + 2] = srcPixels[srcIndex + 2];\r\n            dstPixels[dstIndex + 3] = srcPixels[srcIndex + 3];\r\n        }\r\n    }\r\n\r\n    return dstImageData;\r\n};\r\n\r\n/**\r\n * Floyd-Steinberg algorithm\r\n * @param levels 2 <= n <= 255\r\n */\r\nImageFilters.Dither = function (srcImageData, levels) {\r\n    var srcWidth     = srcImageData.width,\r\n        srcHeight    = srcImageData.height,\r\n        dstImageData = this.Clone(srcImageData),\r\n        dstPixels    = dstImageData.data;\r\n\r\n    levels = levels < 2 ? 2 : levels > 255 ? 255 : levels;\r\n\r\n    // Build a color map using the same algorithm as the posterize filter.\r\n    var posterize,\r\n        levelMap = [],\r\n        levelsMinus1 = levels - 1,\r\n        j = 0,\r\n        k = 0,\r\n        i;\r\n\r\n    for (i = 0; i < levels; i += 1) {\r\n        levelMap[i] = (255 * i) / levelsMinus1;\r\n    }\r\n\r\n    posterize = this.utils.buildMap(function (value) {\r\n        var ret = levelMap[j];\r\n\r\n        k += levels;\r\n\r\n        if (k > 255) {\r\n            k -= 255;\r\n            j += 1;\r\n        }\r\n\r\n        return ret;\r\n    });\r\n    \r\n    // Apply the dithering algorithm to each pixel\r\n    var x, y,\r\n        index,\r\n        old_r, old_g, old_b,\r\n        new_r, new_g, new_b,\r\n        err_r, err_g, err_b,\r\n        nbr_r, nbr_g, nbr_b,\r\n        srcWidthMinus1 = srcWidth - 1,\r\n        srcHeightMinus1 = srcHeight - 1,\r\n        A = 7 / 16,\r\n        B = 3 / 16,\r\n        C = 5 / 16,\r\n        D = 1 / 16;\r\n    \r\n    for (y = 0; y < srcHeight; y += 1) {\r\n        for (x = 0; x < srcWidth; x += 1) {\r\n            // Get the current pixel.\r\n            index = (y * srcWidth + x) << 2;\r\n            \r\n            old_r = dstPixels[index];\r\n            old_g = dstPixels[index + 1];\r\n            old_b = dstPixels[index + 2];\r\n            \r\n            // Quantize using the color map\r\n            new_r = posterize[old_r];\r\n            new_g = posterize[old_g];\r\n            new_b = posterize[old_b];\r\n            \r\n            // Set the current pixel.\r\n            dstPixels[index]     = new_r;\r\n            dstPixels[index + 1] = new_g;\r\n            dstPixels[index + 2] = new_b;\r\n            \r\n            // Quantization errors\r\n            err_r = old_r - new_r;\r\n            err_g = old_g - new_g;\r\n            err_b = old_b - new_b;\r\n            \r\n            // Apply the matrix.\r\n            // x + 1, y\r\n            index += 1 << 2;\r\n            if (x < srcWidthMinus1) {\r\n                nbr_r = dstPixels[index]     + A * err_r;\r\n                nbr_g = dstPixels[index + 1] + A * err_g;\r\n                nbr_b = dstPixels[index + 2] + A * err_b;\r\n                \r\n                dstPixels[index]     = nbr_r > 255 ? 255 : nbr_r < 0 ? 0 : nbr_r | 0;\r\n                dstPixels[index + 1] = nbr_g > 255 ? 255 : nbr_g < 0 ? 0 : nbr_g | 0;\r\n                dstPixels[index + 2] = nbr_b > 255 ? 255 : nbr_b < 0 ? 0 : nbr_b | 0;\r\n            }\r\n            \r\n            // x - 1, y + 1\r\n            index += (srcWidth - 2) << 2;\r\n            if (x > 0 && y < srcHeightMinus1) {\r\n                nbr_r = dstPixels[index]     + B * err_r;\r\n                nbr_g = dstPixels[index + 1] + B * err_g;\r\n                nbr_b = dstPixels[index + 2] + B * err_b;\r\n                \r\n                dstPixels[index]     = nbr_r > 255 ? 255 : nbr_r < 0 ? 0 : nbr_r | 0;\r\n                dstPixels[index + 1] = nbr_g > 255 ? 255 : nbr_g < 0 ? 0 : nbr_g | 0;\r\n                dstPixels[index + 2] = nbr_b > 255 ? 255 : nbr_b < 0 ? 0 : nbr_b | 0;\r\n            }\r\n            \r\n            // x, y + 1\r\n            index += 1 << 2;\r\n            if (y < srcHeightMinus1) {\r\n                nbr_r = dstPixels[index]     + C * err_r;\r\n                nbr_g = dstPixels[index + 1] + C * err_g;\r\n                nbr_b = dstPixels[index + 2] + C * err_b;\r\n                \r\n                dstPixels[index]     = nbr_r > 255 ? 255 : nbr_r < 0 ? 0 : nbr_r | 0;\r\n                dstPixels[index + 1] = nbr_g > 255 ? 255 : nbr_g < 0 ? 0 : nbr_g | 0;\r\n                dstPixels[index + 2] = nbr_b > 255 ? 255 : nbr_b < 0 ? 0 : nbr_b | 0;\r\n            }\r\n            \r\n            // x + 1, y + 1\r\n            index += 1 << 2;\r\n            if (x < srcWidthMinus1 && y < srcHeightMinus1) {\r\n                nbr_r = dstPixels[index]     + D * err_r;\r\n                nbr_g = dstPixels[index + 1] + D * err_g;\r\n                nbr_b = dstPixels[index + 2] + D * err_b;\r\n                \r\n                dstPixels[index]     = nbr_r > 255 ? 255 : nbr_r < 0 ? 0 : nbr_r | 0;\r\n                dstPixels[index + 1] = nbr_g > 255 ? 255 : nbr_g < 0 ? 0 : nbr_g | 0;\r\n                dstPixels[index + 2] = nbr_b > 255 ? 255 : nbr_b < 0 ? 0 : nbr_b | 0;\r\n            }\r\n        }\r\n    }\r\n\r\n    return dstImageData;\r\n};\r\n\r\nImageFilters.Edge = function (srcImageData) {\r\n    //pretty close to Fireworks 'Find Edges' effect\r\n    return this.ConvolutionFilter(srcImageData, 3, 3, [\r\n        -1, -1, -1,\r\n        -1,  8, -1,\r\n        -1, -1, -1\r\n    ]);\r\n};\r\n\r\nImageFilters.Emboss = function (srcImageData) {\r\n    return this.ConvolutionFilter(srcImageData, 3, 3, [\r\n        -2, -1, 0,\r\n        -1,  1, 1,\r\n         0,  1, 2\r\n    ]);\r\n};\r\n\r\nImageFilters.Enrich = function (srcImageData) {\r\n    return this.ConvolutionFilter(srcImageData, 3, 3, [\r\n         0, -2,  0,\r\n        -2, 20, -2,\r\n         0, -2,  0\r\n    ], 10, -40);\r\n};\r\n\r\nImageFilters.Flip = function (srcImageData, vertical) {\r\n    var srcPixels    = srcImageData.data,\r\n        srcWidth     = srcImageData.width,\r\n        srcHeight    = srcImageData.height,\r\n        srcLength    = srcPixels.length,\r\n        dstImageData = this.utils.createImageData(srcWidth, srcHeight),\r\n        dstPixels    = dstImageData.data;\r\n\r\n    var x, y, srcIndex, dstIndex, i;\r\n\r\n    for (y = 0; y < srcHeight; y += 1) {\r\n        for (x = 0; x < srcWidth; x += 1) {\r\n            srcIndex = (y * srcWidth + x) << 2;\r\n            if (vertical) {\r\n                dstIndex = ((srcHeight - y - 1) * srcWidth + x) << 2;\r\n            }\r\n            else {\r\n                dstIndex = (y * srcWidth + (srcWidth - x - 1)) << 2;\r\n            }\r\n\r\n            dstPixels[dstIndex]     = srcPixels[srcIndex];\r\n            dstPixels[dstIndex + 1] = srcPixels[srcIndex + 1];\r\n            dstPixels[dstIndex + 2] = srcPixels[srcIndex + 2];\r\n            dstPixels[dstIndex + 3] = srcPixels[srcIndex + 3];\r\n        }\r\n    }\r\n\r\n    return dstImageData;\r\n};\r\n\r\nImageFilters.Gamma = function (srcImageData, gamma) {\r\n    var srcPixels    = srcImageData.data,\r\n        srcWidth     = srcImageData.width,\r\n        srcHeight    = srcImageData.height,\r\n        srcLength    = srcPixels.length,\r\n        dstImageData = this.utils.createImageData(srcWidth, srcHeight),\r\n        dstPixels    = dstImageData.data;\r\n\r\n    this.utils.mapRGB(srcPixels, dstPixels, function (value) {\r\n        value = (255 * Math.pow(value / 255, 1 / gamma) + 0.5);\r\n        return value > 255 ? 255 : value + 0.5 | 0;\r\n    });\r\n\r\n    return dstImageData;\r\n};\r\n\r\nImageFilters.GrayScale = function (srcImageData) {\r\n    var srcPixels    = srcImageData.data,\r\n        srcWidth     = srcImageData.width,\r\n        srcHeight    = srcImageData.height,\r\n        srcLength    = srcPixels.length,\r\n        dstImageData = this.utils.createImageData(srcWidth, srcHeight),\r\n        dstPixels    = dstImageData.data;\r\n\r\n    for (var i = 0; i < srcLength; i += 4) {\r\n        var intensity = (srcPixels[i] * 19595 + srcPixels[i + 1] * 38470 + srcPixels[i + 2] * 7471) >> 16;\r\n        //var intensity = (srcPixels[i] * 0.3086 + srcPixels[i + 1] * 0.6094 + srcPixels[i + 2] * 0.0820) | 0;\r\n        dstPixels[i] = dstPixels[i + 1] = dstPixels[i + 2] = intensity;\r\n        dstPixels[i + 3] = srcPixels[i + 3];\r\n    }\r\n\r\n    return dstImageData;\r\n};\r\n\r\n/**\r\n * @param hueDelta  -180 <= n <= 180\r\n * @param satDelta  -100 <= n <= 100\r\n * @param lightness -100 <= n <= 100\r\n */\r\nImageFilters.HSLAdjustment = function (srcImageData, hueDelta, satDelta, lightness) {\r\n    var srcPixels    = srcImageData.data,\r\n        srcWidth     = srcImageData.width,\r\n        srcHeight    = srcImageData.height,\r\n        srcLength    = srcPixels.length,\r\n        dstImageData = this.utils.createImageData(srcWidth, srcHeight),\r\n        dstPixels    = dstImageData.data;\r\n\r\n    hueDelta /= 360;\r\n    satDelta /= 100;\r\n    lightness /= 100;\r\n\r\n    var rgbToHsl = this.utils.rgbToHsl;\r\n    var hslToRgb = this.utils.hslToRgb;\r\n    var h, s, l, hsl, rgb, i;\r\n\r\n    for (i = 0; i < srcLength; i += 4) {\r\n        // convert to HSL\r\n        hsl = rgbToHsl(srcPixels[i], srcPixels[i + 1], srcPixels[i + 2]);\r\n\r\n        // hue\r\n        h = hsl[0] + hueDelta;\r\n        while (h < 0) {\r\n            h += 1;\r\n        }\r\n        while (h > 1) {\r\n            h -= 1;\r\n        }\r\n\r\n        // saturation\r\n        s = hsl[1] + hsl[1] * satDelta;\r\n        if (s < 0) {\r\n            s = 0;\r\n        }\r\n        else if (s > 1) {\r\n            s = 1;\r\n        }\r\n\r\n        // lightness\r\n        l = hsl[2];\r\n        if (lightness > 0) {\r\n            l += (1 - l) * lightness;\r\n        }\r\n        else if (lightness < 0) {\r\n            l += l * lightness;\r\n        }\r\n\r\n        // convert back to rgb\r\n        rgb = hslToRgb(h, s, l);\r\n\r\n        dstPixels[i]     = rgb[0];\r\n        dstPixels[i + 1] = rgb[1];\r\n        dstPixels[i + 2] = rgb[2];\r\n        dstPixels[i + 3] = srcPixels[i + 3];\r\n    }\r\n\r\n    return dstImageData;\r\n};\r\n\r\nImageFilters.Invert = function (srcImageData) {\r\n    var srcPixels    = srcImageData.data,\r\n        srcWidth     = srcImageData.width,\r\n        srcHeight    = srcImageData.height,\r\n        srcLength    = srcPixels.length,\r\n        dstImageData = this.utils.createImageData(srcWidth, srcHeight),\r\n        dstPixels    = dstImageData.data;\r\n\r\n    this.utils.mapRGB(srcPixels, dstPixels, function (value) {\r\n        return 255 - value;\r\n    });\r\n\r\n    return dstImageData;\r\n};\r\n\r\nImageFilters.Mosaic = function (srcImageData, blockSize) {\r\n    var srcPixels    = srcImageData.data,\r\n        srcWidth     = srcImageData.width,\r\n        srcHeight    = srcImageData.height,\r\n        srcLength    = srcPixels.length,\r\n        dstImageData = this.utils.createImageData(srcWidth, srcHeight),\r\n        dstPixels    = dstImageData.data;\r\n    \r\n    var cols = Math.ceil(srcWidth / blockSize),\r\n        rows = Math.ceil(srcHeight / blockSize),\r\n        row, col,\r\n        x_start, x_end, y_start, y_end,\r\n        x, y, yIndex, index, size,\r\n        r, g, b, a;\r\n\r\n    for (row = 0; row < rows; row += 1) {\r\n        y_start = row * blockSize;\r\n        y_end   = y_start + blockSize;\r\n        \r\n        if (y_end > srcHeight) {\r\n            y_end = srcHeight;\r\n        }\r\n        \r\n        for (col = 0; col < cols; col += 1) {\r\n            x_start = col * blockSize;\r\n            x_end   = x_start + blockSize;\r\n            \r\n            if (x_end > srcWidth) {\r\n                x_end = srcWidth;\r\n            }\r\n\r\n            // get the average color from the src\r\n            r = g = b = a = 0;\r\n            size = (x_end - x_start) * (y_end - y_start);\r\n\r\n            for (y = y_start; y < y_end; y += 1) {\r\n                yIndex = y * srcWidth;\r\n                \r\n                for (x = x_start; x < x_end; x += 1) {\r\n                    index = (yIndex + x) << 2;\r\n                    r += srcPixels[index];\r\n                    g += srcPixels[index + 1];\r\n                    b += srcPixels[index + 2];\r\n                    a += srcPixels[index + 3];\r\n                }\r\n            }\r\n\r\n            r = (r / size) + 0.5 | 0;\r\n            g = (g / size) + 0.5 | 0;\r\n            b = (b / size) + 0.5 | 0;\r\n            a = (a / size) + 0.5 | 0;\r\n\r\n            // fill the dst with that color\r\n            for (y = y_start; y < y_end; y += 1) {\r\n                yIndex = y * srcWidth;\r\n                \r\n                for (x = x_start; x < x_end; x += 1) {\r\n                    index = (yIndex + x) << 2;\r\n                    dstPixels[index]     = r;\r\n                    dstPixels[index + 1] = g;\r\n                    dstPixels[index + 2] = b;\r\n                    dstPixels[index + 3] = a;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    return dstImageData;\r\n};\r\n\r\n/**\r\n * @param range  1 <= n <= 5\r\n * @param levels 1 <= n <= 256\r\n */\r\nImageFilters.Oil = function (srcImageData, range, levels) {\r\n    var srcPixels    = srcImageData.data,\r\n        srcWidth     = srcImageData.width,\r\n        srcHeight    = srcImageData.height,\r\n        srcLength    = srcPixels.length,\r\n        dstImageData = this.utils.createImageData(srcWidth, srcHeight),\r\n        dstPixels    = dstImageData.data;\r\n    \r\n    var index = 0,\r\n        rh = [],\r\n        gh = [],\r\n        bh = [],\r\n        rt = [],\r\n        gt = [],\r\n        bt = [],\r\n        x, y, i, row, col,\r\n        rowIndex, colIndex, offset, srcIndex,\r\n        sr, sg, sb, ri, gi, bi,\r\n        r, g, b;\r\n    \r\n    for (y = 0; y < srcHeight; y += 1) {\r\n        for (x = 0; x < srcWidth; x += 1) {\r\n            for (i = 0; i < levels; i += 1) {\r\n                rh[i] = gh[i] = bh[i] = rt[i] = gt[i] = bt[i] = 0;\r\n            }\r\n            \r\n            for (row = -range; row <= range; row += 1) {\r\n                rowIndex = y + row;\r\n                \r\n                if (rowIndex < 0 || rowIndex >= srcHeight) {\r\n                    continue;\r\n                }\r\n                \r\n                offset = rowIndex * srcWidth;\r\n                \r\n                for (col = -range; col <= range; col += 1) {\r\n                    colIndex = x + col;\r\n                    if (colIndex < 0 || colIndex >= srcWidth) {\r\n                        continue;\r\n                    }\r\n                    \r\n                    srcIndex = (offset + colIndex) << 2;\r\n                    sr = srcPixels[srcIndex];\r\n                    sg = srcPixels[srcIndex + 1];\r\n                    sb = srcPixels[srcIndex + 2];\r\n                    ri = (sr * levels) >> 8;\r\n                    gi = (sg * levels) >> 8;\r\n                    bi = (sb * levels) >> 8;\r\n                    rt[ri] += sr;\r\n                    gt[gi] += sg;\r\n                    bt[bi] += sb;\r\n                    rh[ri] += 1;\r\n                    gh[gi] += 1;\r\n                    bh[bi] += 1;\r\n                }\r\n            }\r\n\r\n            r = g = b = 0;\r\n            for (i = 1; i < levels; i += 1) {\r\n                if(rh[i] > rh[r]) {\r\n                    r = i;\r\n                }\r\n                if(gh[i] > gh[g]) {\r\n                    g = i;\r\n                }\r\n                if(bh[i] > bh[b]) {\r\n                    b = i;\r\n                }\r\n            }\r\n\r\n            dstPixels[index]     = rt[r] / rh[r] | 0;\r\n            dstPixels[index + 1] = gt[g] / gh[g] | 0;\r\n            dstPixels[index + 2] = bt[b] / bh[b] | 0;\r\n            dstPixels[index + 3] = srcPixels[index + 3];\r\n            index += 4;\r\n        }\r\n    }\r\n\r\n    return dstImageData;\r\n};\r\n\r\nImageFilters.OpacityFilter = function (srcImageData, opacity) {\r\n    var srcPixels    = srcImageData.data,\r\n        srcWidth     = srcImageData.width,\r\n        srcHeight    = srcImageData.height,\r\n        srcLength    = srcPixels.length,\r\n        dstImageData = this.utils.createImageData(srcWidth, srcHeight),\r\n        dstPixels    = dstImageData.data;\r\n\r\n    for (var i = 0; i < srcLength; i += 4) {\r\n        dstPixels[i]     = srcPixels[i];\r\n        dstPixels[i + 1] = srcPixels[i + 1];\r\n        dstPixels[i + 2] = srcPixels[i + 2];\r\n        dstPixels[i + 3] = opacity;\r\n    }\r\n\r\n    return dstImageData;\r\n};\r\n\r\n/**\r\n * @param levels 2 <= n <= 255\r\n */\r\nImageFilters.Posterize = function (srcImageData, levels) {\r\n    var srcPixels    = srcImageData.data,\r\n        srcWidth     = srcImageData.width,\r\n        srcHeight    = srcImageData.height,\r\n        srcLength    = srcPixels.length,\r\n        dstImageData = this.utils.createImageData(srcWidth, srcHeight),\r\n        dstPixels    = dstImageData.data;\r\n\r\n    levels = levels < 2 ? 2 : levels > 255 ? 255 : levels;\r\n\r\n    var levelMap = [],\r\n        levelsMinus1 = levels - 1,\r\n        j = 0,\r\n        k = 0,\r\n        i;\r\n\r\n    for (i = 0; i < levels; i += 1) {\r\n        levelMap[i] = (255 * i) / levelsMinus1;\r\n    }\r\n\r\n    this.utils.mapRGB(srcPixels, dstPixels, function (value) {\r\n        var ret = levelMap[j];\r\n\r\n        k += levels;\r\n\r\n        if (k > 255) {\r\n            k -= 255;\r\n            j += 1;\r\n        }\r\n\r\n        return ret;\r\n    });\r\n\r\n    return dstImageData;\r\n};\r\n\r\n/**\r\n * @param scale 0.0 <= n <= 5.0\r\n */\r\nImageFilters.Rescale = function (srcImageData, scale) {\r\n    var srcPixels    = srcImageData.data,\r\n        srcWidth     = srcImageData.width,\r\n        srcHeight    = srcImageData.height,\r\n        srcLength    = srcPixels.length,\r\n        dstImageData = this.utils.createImageData(srcWidth, srcHeight),\r\n        dstPixels    = dstImageData.data;\r\n\r\n    this.utils.mapRGB(srcPixels, dstPixels, function (value) {\r\n        value *= scale;\r\n        return (value > 255) ? 255 : value + 0.5 | 0;\r\n    });\r\n\r\n    return dstImageData;\r\n};\r\n\r\n/**\r\n * Nearest neighbor\r\n */\r\nImageFilters.ResizeNearestNeighbor = function (srcImageData, width, height) {\r\n    var srcPixels    = srcImageData.data,\r\n        srcWidth     = srcImageData.width,\r\n        srcHeight    = srcImageData.height,\r\n        srcLength    = srcPixels.length,\r\n        dstImageData = this.utils.createImageData(width, height),\r\n        dstPixels    = dstImageData.data;\r\n\r\n    var xFactor = srcWidth / width,\r\n        yFactor = srcHeight / height,\r\n        dstIndex = 0, srcIndex,\r\n        x, y, offset;\r\n\r\n    for (y = 0; y < height; y += 1) {\r\n        offset = ((y * yFactor) | 0) * srcWidth;\r\n\r\n        for (x = 0; x < width; x += 1) {\r\n            srcIndex = (offset + x * xFactor) << 2;\r\n\r\n            dstPixels[dstIndex]     = srcPixels[srcIndex];\r\n            dstPixels[dstIndex + 1] = srcPixels[srcIndex + 1];\r\n            dstPixels[dstIndex + 2] = srcPixels[srcIndex + 2];\r\n            dstPixels[dstIndex + 3] = srcPixels[srcIndex + 3];\r\n            dstIndex += 4;\r\n        }\r\n    }\r\n\r\n    return dstImageData;\r\n};\r\n\r\n/**\r\n * Bilinear\r\n */\r\nImageFilters.Resize = function (srcImageData, width, height) {\r\n    var srcPixels    = srcImageData.data,\r\n        srcWidth     = srcImageData.width,\r\n        srcHeight    = srcImageData.height,\r\n        srcLength    = srcPixels.length,\r\n        dstImageData = this.utils.createImageData(width, height),\r\n        dstPixels    = dstImageData.data;\r\n\r\n    var xFactor = srcWidth / width,\r\n        yFactor = srcHeight / height,\r\n        dstIndex = 0,\r\n        x, y;\r\n\r\n    for (y = 0; y < height; y += 1) {\r\n        for (x = 0; x < width; x += 1) {\r\n            this.utils.copyBilinear(srcPixels, x * xFactor, y * yFactor, srcWidth, srcHeight, dstPixels, dstIndex, 0);\r\n            dstIndex += 4;\r\n        }\r\n    }\r\n\r\n    return dstImageData;\r\n};\r\n\r\n\r\n/**\r\n * faster resizing using the builtin context.scale()\r\n * the resizing algorithm may be different between browsers\r\n * this might not work if the image is transparent.\r\n * to fix that we probably need two contexts\r\n */\r\nImageFilters.ResizeBuiltin = function (srcImageData, width, height) {\r\n    var srcWidth     = srcImageData.width,\r\n        srcHeight    = srcImageData.height,\r\n        canvas    = this.utils.getSampleCanvas(),\r\n        context   = this.utils.getSampleContext(),\r\n        dstImageData;\r\n\r\n    canvas.width  = Math.max(srcWidth, width);\r\n    canvas.height = Math.max(srcHeight, height);\r\n    context.save();\r\n\r\n    context.putImageData(srcImageData, 0, 0);\r\n    context.scale(width / srcWidth, height / srcHeight);\r\n    context.drawImage(canvas, 0, 0);\r\n\r\n    dstImageData = context.getImageData(0, 0, width, height);\r\n\r\n    context.restore();\r\n    canvas.width = 0;\r\n    canvas.height = 0;\r\n\r\n    return dstImageData;\r\n};\r\n\r\nImageFilters.Sepia = function (srcImageData) {\r\n    var srcPixels    = srcImageData.data,\r\n        srcWidth     = srcImageData.width,\r\n        srcHeight    = srcImageData.height,\r\n        srcLength    = srcPixels.length,\r\n        dstImageData = this.utils.createImageData(srcWidth, srcHeight),\r\n        dstPixels    = dstImageData.data;\r\n\r\n    var r, g, b, i, value;\r\n\r\n    for (i = 0; i < srcLength; i += 4) {\r\n        r = srcPixels[i];\r\n        g = srcPixels[i + 1];\r\n        b = srcPixels[i + 2];\r\n\r\n        dstPixels[i]     = (value = r * 0.393 + g * 0.769 + b * 0.189) > 255 ? 255 : value < 0 ? 0 : value + 0.5 | 0;\r\n        dstPixels[i + 1] = (value = r * 0.349 + g * 0.686 + b * 0.168) > 255 ? 255 : value < 0 ? 0 : value + 0.5 | 0;\r\n        dstPixels[i + 2] = (value = r * 0.272 + g * 0.534 + b * 0.131) > 255 ? 255 : value < 0 ? 0 : value + 0.5 | 0;\r\n        dstPixels[i + 3] = srcPixels[i + 3];\r\n    }\r\n\r\n    return dstImageData;\r\n};\r\n\r\n/**\r\n * @param factor 1 <= n\r\n */\r\nImageFilters.Sharpen = function (srcImageData, factor) {\r\n    //Convolution formula from VIGRA\r\n    return this.ConvolutionFilter(srcImageData, 3, 3, [\r\n        -factor/16,     -factor/8,      -factor/16,\r\n        -factor/8,       factor*0.75+1, -factor/8,\r\n        -factor/16,     -factor/8,      -factor/16\r\n    ]);\r\n};\r\n\r\nImageFilters.Solarize = function (srcImageData) {\r\n    var srcPixels    = srcImageData.data,\r\n        srcWidth     = srcImageData.width,\r\n        srcHeight    = srcImageData.height,\r\n        srcLength    = srcPixels.length,\r\n        dstImageData = this.utils.createImageData(srcWidth, srcHeight),\r\n        dstPixels    = dstImageData.data;\r\n\r\n    this.utils.mapRGB(srcPixels, dstPixels, function (value) {\r\n        return value > 127 ? (value - 127.5) * 2 : (127.5 - value) * 2;\r\n    });\r\n\r\n    return dstImageData;\r\n};\r\n\r\nImageFilters.Transpose = function (srcImageData) {\r\n    var srcPixels    = srcImageData.data,\r\n        srcWidth     = srcImageData.width,\r\n        srcHeight    = srcImageData.height,\r\n        srcLength    = srcPixels.length,\r\n        dstImageData = this.utils.createImageData(srcHeight, srcWidth),\r\n        dstPixels    = dstImageData.data;\r\n    \r\n    var srcIndex, dstIndex;\r\n    \r\n    for (y = 0; y < srcHeight; y += 1) {\r\n        for (x = 0; x < srcWidth; x += 1) {\r\n            srcIndex = (y * srcWidth + x) << 2;\r\n            dstIndex = (x * srcHeight + y) << 2;\r\n\r\n            dstPixels[dstIndex]     = srcPixels[srcIndex];\r\n            dstPixels[dstIndex + 1] = srcPixels[srcIndex + 1];\r\n            dstPixels[dstIndex + 2] = srcPixels[srcIndex + 2];\r\n            dstPixels[dstIndex + 3] = srcPixels[srcIndex + 3];\r\n        }\r\n    }\r\n    \r\n    return dstImageData;\r\n};\r\n\r\n/**\r\n * @param centerX 0.0 <= n <= 1.0\r\n * @param centerY 0.0 <= n <= 1.0\r\n * @param radius\r\n * @param angle(degree)\r\n * @param smooth\r\n */\r\nImageFilters.Twril = function (srcImageData, centerX, centerY, radius, angle, edge, smooth) {\r\n    var srcPixels    = srcImageData.data,\r\n        srcWidth     = srcImageData.width,\r\n        srcHeight    = srcImageData.height,\r\n        srcLength    = srcPixels.length,\r\n        dstImageData = this.utils.createImageData(srcWidth, srcHeight),\r\n        dstPixels    = dstImageData.data;\r\n\r\n    //convert position to px\r\n    centerX = srcWidth  * centerX;\r\n    centerY = srcHeight * centerY;\r\n\r\n    // degree to radian\r\n    angle *= (Math.PI / 180);\r\n\r\n    var radius2 = radius * radius,\r\n        max_y = srcHeight - 1,\r\n        max_x = srcWidth - 1,\r\n        dstIndex = 0,\r\n        x, y, dx, dy, distance, a, tx, ty, srcIndex, pixel, i;\r\n\r\n    for (y = 0; y < srcHeight; y += 1) {\r\n        for (x = 0; x < srcWidth; x += 1) {\r\n            dx = x - centerX;\r\n            dy = y - centerY;\r\n            distance = dx * dx + dy * dy;\r\n\r\n            if (distance > radius2) {\r\n                // out of the effected area. just copy the pixel\r\n                dstPixels[dstIndex]     = srcPixels[dstIndex];\r\n                dstPixels[dstIndex + 1] = srcPixels[dstIndex + 1];\r\n                dstPixels[dstIndex + 2] = srcPixels[dstIndex + 2];\r\n                dstPixels[dstIndex + 3] = srcPixels[dstIndex + 3];\r\n            }\r\n            else {\r\n                // main formula\r\n                distance = Math.sqrt(distance);\r\n                a  = Math.atan2(dy, dx) + (angle * (radius - distance)) / radius;\r\n                tx = centerX + distance * Math.cos(a);\r\n                ty = centerY + distance * Math.sin(a);\r\n\r\n                // copy target pixel\r\n                if (smooth) {\r\n                    // bilinear\r\n                    this.utils.copyBilinear(srcPixels, tx, ty, srcWidth, srcHeight, dstPixels, dstIndex, edge);\r\n                }\r\n                else {\r\n                    // nearest neighbor\r\n                    // round tx, ty\r\n                    // TODO edge actions!!\r\n                    srcIndex = ((ty + 0.5 | 0) * srcWidth + (tx + 0.5 | 0)) << 2;\r\n                    dstPixels[dstIndex]     = srcPixels[srcIndex];\r\n                    dstPixels[dstIndex + 1] = srcPixels[srcIndex + 1];\r\n                    dstPixels[dstIndex + 2] = srcPixels[srcIndex + 2];\r\n                    dstPixels[dstIndex + 3] = srcPixels[srcIndex + 3];\r\n                }\r\n            }\r\n            \r\n            dstIndex += 4;\r\n        }\r\n    }\r\n\r\n    return dstImageData;\r\n};\r\n\r\nexport default ImageFilters","const filterValue = [\r\n  {\r\n    name: 'HSLAdjustment',\r\n    chooseValue: ['h', 's', 'l'],\r\n    range: [{\r\n      min: -180,\r\n      max: 180,\r\n      first: 0\r\n    }, {\r\n      min: -100,\r\n      max: 100,\r\n      first: 0\r\n    }, {\r\n      min: -100,\r\n      max: 100,\r\n      first: 0\r\n    }]\r\n  }, {\r\n    name: 'GrayScale',\r\n    chooseValue: [],\r\n    range: []\r\n  }, {\r\n    name: 'Gamma',\r\n    chooseValue: ['g'],\r\n    range: [{\r\n      min: 0,\r\n      max: 3,\r\n      first: 1\r\n    }]\r\n  }, {\r\n    name: 'BrightnessContrastGimp',\r\n    chooseValue: ['b', 'c'],\r\n    range: [{\r\n      min: -100,\r\n      max: 100,\r\n      first: 30\r\n    }, {\r\n      min: -100,\r\n      max: 100,\r\n      first: 30\r\n    }]\r\n  }, {\r\n    name: 'Edge',\r\n    chooseValue: [],\r\n    range: []\r\n  }, {\r\n    name: 'Emboss',\r\n    chooseValue: [],\r\n    range: []\r\n  }, {\r\n    name: 'Invert',\r\n    chooseValue: [],\r\n    range: []\r\n  }, {\r\n    name: 'Oil',\r\n    chooseValue: ['r', 'l'],\r\n    range: [{\r\n      min: 1,\r\n      max: 5,\r\n      first: 2\r\n    }, {\r\n      min: 1,\r\n      max: 255,\r\n      first: 50\r\n    }]\r\n  }, {\r\n    name: 'Solarize',\r\n    chooseValue: [],\r\n    range: []\r\n  }, {\r\n    name: 'Twril',\r\n    chooseValue: ['cx', 'cy', 'r', 'angle', 'edge', 'smooth'],\r\n    range: [{\r\n      min: 0.5,\r\n      max: 0.5,\r\n      first: 0.5\r\n    }, {\r\n      min: 0.5,\r\n      max: 0.5,\r\n      first: 0.5\r\n    }, {\r\n      min: 10,\r\n      max: 200,\r\n      first: 100\r\n    }, {\r\n      min: -720,\r\n      max: 720,\r\n      first: 100\r\n    }, {\r\n      min: 0,\r\n      max: 0,\r\n      first: 'Clamp'\r\n    }, {\r\n      min: 1,\r\n      max: 1,\r\n      first: 1\r\n    }]\r\n  }\r\n]\r\n\r\nexport default {\r\n  filterValue: filterValue\r\n}\r\n"]}